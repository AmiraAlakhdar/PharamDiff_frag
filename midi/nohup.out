Global seed set to 0
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 0
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81168, 8: 13156, 7: 2240, 6: 443, 5: 76, 4: 17, 3: 5, 2: 2})
NUM NODES IN STATISTICS Counter({9: 16558, 8: 2764, 7: 488, 6: 68, 5: 18, 4: 6, 3: 1})
NUM NODES IN STATISTICS Counter({9: 10791, 8: 1798, 7: 304, 6: 68, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7245, 0.1132, 0.1597, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-07-10 22:53:09,006][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-07-10 22:53:09,007][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.1 M
----------------------------------------------------------------
20.1 M    Trainable params
0         Non-trainable params
20.1 M    Total params
80.338    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.17.4 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/wandb/run-20240710_225311-3j440oum
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/3j440oum
Epoch 0: val/epoch_NLL: 1407216768.00 -- val/pos_mse: 1407211776.00 -- val/X_kl: 2337.01 -- val/E_kl: 4401.67 -- val/charges_kl: 3340.25 
Val loss: 1407216768.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Train epoch 0 ends
Epoch 0 finished: pos: 0.73 -- X: 0.63 -- charges: 0.13 -- E: 0.56 -- y: -1.00 -- 99.8s 
Starting epoch 1
Train epoch 1 ends
Epoch 1 finished: pos: 0.41 -- X: 0.59 -- charges: 0.12 -- E: 0.37 -- y: -1.00 -- 97.2s 
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: pos: 0.30 -- X: 0.48 -- charges: 0.11 -- E: 0.32 -- y: -1.00 -- 96.9s 
Starting epoch 3
Train epoch 3 ends
Epoch 3 finished: pos: 0.27 -- X: 0.33 -- charges: 0.08 -- E: 0.29 -- y: -1.00 -- 96.8s 
Starting epoch 4
Train epoch 4 ends
Epoch 4 finished: pos: 0.26 -- X: 0.29 -- charges: 0.07 -- E: 0.28 -- y: -1.00 -- 96.8s 
Starting epoch 5
Train epoch 5 ends
Epoch 5 finished: pos: 0.25 -- X: 0.27 -- charges: 0.07 -- E: 0.27 -- y: -1.00 -- 95.9s 
Starting epoch 6
Train epoch 6 ends
Epoch 6 finished: pos: 0.25 -- X: 0.26 -- charges: 0.06 -- E: 0.26 -- y: -1.00 -- 96.6s 
Starting epoch 7
Train epoch 7 ends
Epoch 7 finished: pos: 0.25 -- X: 0.25 -- charges: 0.06 -- E: 0.26 -- y: -1.00 -- 96.3s 
Starting epoch 8
Train epoch 8 ends
Epoch 8 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 96.4s 
Starting epoch 9
Train epoch 9 ends
Epoch 9 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 95.8s 
Starting epoch 10
Train epoch 10 ends
Epoch 10 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 96.2s 
Starting epoch 11
Train epoch 11 ends
Epoch 11 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 96.4s 
Starting epoch 12
Train epoch 12 ends
Epoch 12 finished: pos: 0.24 -- X: 0.23 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 96.4s 
Starting epoch 13
Train epoch 13 ends
Epoch 13 finished: pos: 0.24 -- X: 0.23 -- charges: 0.06 -- E: 0.24 -- y: -1.00 -- 95.9s 
Starting epoch 14
Train epoch 14 ends
Epoch 14 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 98.4s 
Starting epoch 15
Train epoch 15 ends
Epoch 15 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 96.6s 
Starting epoch 16
Train epoch 16 ends
Epoch 16 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 96.5s 
Starting epoch 17
Train epoch 17 ends
Epoch 17 finished: pos: 0.24 -- X: 0.22 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 96.4s 
Starting epoch 18
Train epoch 18 ends
Epoch 18 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.6s 
Starting epoch 19
Epoch 19: val/epoch_NLL: 3366367.00 -- val/pos_mse: 3366031.75 -- val/X_kl: 2784.11 -- val/E_kl: 3063.47 -- val/charges_kl: 801.94 
Val loss: 3366367.0000 	 Best val loss:  3366367.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch19/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 418.03 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 154, Kekulize 22, other 4,  -- No error 844
Validity over 1024 molecules: 82.42%
Number of connected components of 1024 molecules: mean:1.12 max:3.00
Connected components of 1024 molecules: 87.99
Uniqueness: 99.53% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 4.39%
rdkit pharmacophore match: 79.28%
rdkit valid pharmacophore match: 79.24%
pgmg pharmacophore match: 81.41%
pgmg valid pharmacophore match: 82.19%
pgmg pharmacophore match percentage: 72.92%
Sparsity level on local rank 0: 75 %
Sampling metrics {'sampling/NumNodesW1': 0.015, 'sampling/AtomTypesTV': 0.061, 'sampling/EdgeTypesTV': 0.051, 'sampling/ChargeW1': 0.009, 'sampling/ValencyW1': 0.303, 'sampling/BondLengthsW1': 0.023, 'sampling/AnglesW1': 7.047}
Sampling metrics done.
Val epoch 19 ends
Train epoch 19 ends
Epoch 19 finished: pos: 0.24 -- X: 0.22 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 538.6s 
Starting epoch 20
Train epoch 20 ends
Epoch 20 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 97.0s 
Starting epoch 21
Train epoch 21 ends
Epoch 21 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.8s 
Starting epoch 22
Train epoch 22 ends
Epoch 22 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.8s 
Starting epoch 23
Train epoch 23 ends
Epoch 23 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.8s 
Starting epoch 24
Train epoch 24 ends
Epoch 24 finished: pos: 0.24 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.7s 
Starting epoch 25
Train epoch 25 ends
Epoch 25 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.8s 
Starting epoch 26
Train epoch 26 ends
Epoch 26 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.8s 
Starting epoch 27
Train epoch 27 ends
Epoch 27 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.9s 
Starting epoch 28
Train epoch 28 ends
Epoch 28 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 98.3s 
Starting epoch 29
Train epoch 29 ends
Epoch 29 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.7s 
Starting epoch 30
Train epoch 30 ends
Epoch 30 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.9s 
Starting epoch 31
Train epoch 31 ends
Epoch 31 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.5s 
Starting epoch 32
Train epoch 32 ends
Epoch 32 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 96.5s 
Starting epoch 33
Train epoch 33 ends
Epoch 33 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 97.2s 
Starting epoch 34
Train epoch 34 ends
Epoch 34 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.0s 
Starting epoch 35
Train epoch 35 ends
Epoch 35 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.4s 
Starting epoch 36
Train epoch 36 ends
Epoch 36 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.4s 
Starting epoch 37
Train epoch 37 ends
Epoch 37 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.2s 
Starting epoch 38
Train epoch 38 ends
Epoch 38 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.3s 
Starting epoch 39
Epoch 39: val/epoch_NLL: 930727.69 -- val/pos_mse: 930420.69 -- val/X_kl: 2534.17 -- val/E_kl: 2753.52 -- val/charges_kl: 790.29 
Val loss: 930727.6875 	 Best val loss:  930727.6875

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch39/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 415.83 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 73, Kekulize 2, other 0,  -- No error 949
Validity over 1024 molecules: 92.68%
Number of connected components of 1024 molecules: mean:1.03 max:2.00
Connected components of 1024 molecules: 96.97
Uniqueness: 98.63% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 4.48%
rdkit pharmacophore match: 76.86%
rdkit valid pharmacophore match: 75.66%
pgmg pharmacophore match: 80.80%
pgmg valid pharmacophore match: 81.02%
pgmg pharmacophore match percentage: 72.15%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.019, 'sampling/AtomTypesTV': 0.062, 'sampling/EdgeTypesTV': 0.036, 'sampling/ChargeW1': 0.005, 'sampling/ValencyW1': 0.196, 'sampling/BondLengthsW1': 0.036, 'sampling/AnglesW1': 4.556}
Sampling metrics done.
Val epoch 39 ends
Train epoch 39 ends
Epoch 39 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 535.2s 
Starting epoch 40
Train epoch 40 ends
Epoch 40 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 41
Train epoch 41 ends
Epoch 41 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 99.9s 
Starting epoch 42
Train epoch 42 ends
Epoch 42 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 43
Train epoch 43 ends
Epoch 43 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 44
Train epoch 44 ends
Epoch 44 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 45
Train epoch 45 ends
Epoch 45 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 46
Train epoch 46 ends
Epoch 46 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 47
Train epoch 47 ends
Epoch 47 finished: pos: 0.23 -- X: 0.21 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.5s 
Starting epoch 48
Train epoch 48 ends
Epoch 48 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.6s 
Starting epoch 49
Train epoch 49 ends
Epoch 49 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.6s 
Starting epoch 50
Train epoch 50 ends
Epoch 50 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 51
Train epoch 51 ends
Epoch 51 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 52
Train epoch 52 ends
Epoch 52 finished: pos: 0.23 -- X: 0.20 -- charges: 0.05 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 53
Train epoch 53 ends
Epoch 53 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 54
Train epoch 54 ends
Epoch 54 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 55
Train epoch 55 ends
Epoch 55 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 98.7s 
Starting epoch 56
Train epoch 56 ends
Epoch 56 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.4s 
Starting epoch 57
Train epoch 57 ends
Epoch 57 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 95.8s 
Starting epoch 58
Train epoch 58 ends
Epoch 58 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 59
Epoch 59: val/epoch_NLL: 1360259.25 -- val/pos_mse: 1359961.12 -- val/X_kl: 2582.74 -- val/E_kl: 2736.45 -- val/charges_kl: 591.80 
Val loss: 1360259.2500 	 Best val loss:  930727.6875

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch59/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 419.44 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 89, Kekulize 5, other 0,  -- No error 930
Validity over 1024 molecules: 90.82%
Number of connected components of 1024 molecules: mean:1.04 max:3.00
Connected components of 1024 molecules: 96.68
Uniqueness: 99.46% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.69%
rdkit pharmacophore match: 71.65%
rdkit valid pharmacophore match: 71.80%
pgmg pharmacophore match: 79.01%
pgmg valid pharmacophore match: 79.22%
pgmg pharmacophore match percentage: 70.20%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.015, 'sampling/AtomTypesTV': 0.141, 'sampling/EdgeTypesTV': 0.055, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.058, 'sampling/BondLengthsW1': 0.033, 'sampling/AnglesW1': 5.043}
Sampling metrics done.
Val epoch 59 ends
Train epoch 59 ends
Epoch 59 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 538.5s 
Starting epoch 60
Train epoch 60 ends
Epoch 60 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 61
Train epoch 61 ends
Epoch 61 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 62
Train epoch 62 ends
Epoch 62 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 95.9s 
Starting epoch 63
Train epoch 63 ends
Epoch 63 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 64
Train epoch 64 ends
Epoch 64 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.9s 
Starting epoch 65
Train epoch 65 ends
Epoch 65 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 66
Train epoch 66 ends
Epoch 66 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 67
Train epoch 67 ends
Epoch 67 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 99.2s 
Starting epoch 68
Train epoch 68 ends
Epoch 68 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.6s 
Starting epoch 69
Train epoch 69 ends
Epoch 69 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 95.9s 
Starting epoch 70
Train epoch 70 ends
Epoch 70 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 71
Train epoch 71 ends
Epoch 71 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.5s 
Starting epoch 72
Train epoch 72 ends
Epoch 72 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.9s 
Starting epoch 73
Train epoch 73 ends
Epoch 73 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 74
Train epoch 74 ends
Epoch 74 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 95.7s 
Starting epoch 75
Train epoch 75 ends
Epoch 75 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.5s 
Starting epoch 76
Train epoch 76 ends
Epoch 76 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 95.9s 
Starting epoch 77
Train epoch 77 ends
Epoch 77 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 95.7s 
Starting epoch 78
Train epoch 78 ends
Epoch 78 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.5s 
Starting epoch 79
Epoch 79: val/epoch_NLL: 1136728.62 -- val/pos_mse: 1136453.38 -- val/X_kl: 2332.13 -- val/E_kl: 2562.80 -- val/charges_kl: 556.04 
Val loss: 1136728.6250 	 Best val loss:  930727.6875

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch79/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 401.52 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 60, Kekulize 8, other 0,  -- No error 956
Validity over 1024 molecules: 93.36%
Number of connected components of 1024 molecules: mean:1.03 max:2.00
Connected components of 1024 molecules: 96.88
Uniqueness: 98.64% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 4.17%
rdkit pharmacophore match: 75.76%
rdkit valid pharmacophore match: 75.50%
pgmg pharmacophore match: 79.55%
pgmg valid pharmacophore match: 79.74%
pgmg pharmacophore match percentage: 70.63%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.024, 'sampling/AtomTypesTV': 0.122, 'sampling/EdgeTypesTV': 0.063, 'sampling/ChargeW1': 0.008, 'sampling/ValencyW1': 0.048, 'sampling/BondLengthsW1': 0.036, 'sampling/AnglesW1': 7.911}
Sampling metrics done.
Val epoch 79 ends
Train epoch 79 ends
Epoch 79 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 520.5s 
Starting epoch 80
Train epoch 80 ends
Epoch 80 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.7s 
Starting epoch 81
Train epoch 81 ends
Epoch 81 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.4s 
Starting epoch 82
Train epoch 82 ends
Epoch 82 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 83
Train epoch 83 ends
Epoch 83 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 99.7s 
Starting epoch 84
Train epoch 84 ends
Epoch 84 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 85
Train epoch 85 ends
Epoch 85 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 86
Train epoch 86 ends
Epoch 86 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.6s 
Starting epoch 87
Train epoch 87 ends
Epoch 87 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 88
Train epoch 88 ends
Epoch 88 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 89
Train epoch 89 ends
Epoch 89 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.9s 
Starting epoch 90
Train epoch 90 ends
Epoch 90 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 96.8s 
Starting epoch 91
Train epoch 91 ends
Epoch 91 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 92
Train epoch 92 ends
Epoch 92 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.2s 
Starting epoch 93
Train epoch 93 ends
Epoch 93 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 94
Train epoch 94 ends
Epoch 94 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 95
Train epoch 95 ends
Epoch 95 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 96
Train epoch 96 ends
Epoch 96 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.3s 
Starting epoch 97
Train epoch 97 ends
Epoch 97 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 98
Train epoch 98 ends
Epoch 98 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 99
Epoch 99: val/epoch_NLL: 401174.22 -- val/pos_mse: 400902.00 -- val/X_kl: 2311.30 -- val/E_kl: 2485.54 -- val/charges_kl: 591.01 
Val loss: 401174.2188 	 Best val loss:  401174.2188

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch99/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 413.33 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 38, Kekulize 0, other 0,  -- No error 986
Validity over 1024 molecules: 96.29%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 97.95
Uniqueness: 99.29% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.00%
rdkit pharmacophore match: 71.78%
rdkit valid pharmacophore match: 70.39%
pgmg pharmacophore match: 78.92%
pgmg valid pharmacophore match: 78.75%
pgmg pharmacophore match percentage: 69.83%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.006, 'sampling/AtomTypesTV': 0.157, 'sampling/EdgeTypesTV': 0.079, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.051, 'sampling/BondLengthsW1': 0.017, 'sampling/AnglesW1': 7.951}
Sampling metrics done.
Val epoch 99 ends
Train epoch 99 ends
Epoch 99 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 532.2s 
Starting epoch 100
Train epoch 100 ends
Epoch 100 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 101
Train epoch 101 ends
Epoch 101 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.9s 
Starting epoch 102
Train epoch 102 ends
Epoch 102 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 103
Train epoch 103 ends
Epoch 103 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.0s 
Starting epoch 104
Train epoch 104 ends
Epoch 104 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 105
Train epoch 105 ends
Epoch 105 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 106
Train epoch 106 ends
Epoch 106 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 107
Train epoch 107 ends
Epoch 107 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 108
Train epoch 108 ends
Epoch 108 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 109
Train epoch 109 ends
Epoch 109 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.9s 
Starting epoch 110
Train epoch 110 ends
Epoch 110 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 111
Train epoch 111 ends
Epoch 111 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 112
Train epoch 112 ends
Epoch 112 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 113
Train epoch 113 ends
Epoch 113 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 114
Train epoch 114 ends
Epoch 114 finished: pos: 0.22 -- X: 0.20 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 115
Train epoch 115 ends
Epoch 115 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 116
Train epoch 116 ends
Epoch 116 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 117
Train epoch 117 ends
Epoch 117 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 118
Train epoch 118 ends
Epoch 118 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 119
Epoch 119: val/epoch_NLL: 517406.78 -- val/pos_mse: 517133.44 -- val/X_kl: 2276.50 -- val/E_kl: 2547.83 -- val/charges_kl: 566.44 
Val loss: 517406.7812 	 Best val loss:  401174.2188

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch119/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 405.00 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 53, Kekulize 3, other 0,  -- No error 968
Validity over 1024 molecules: 94.53%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 98.54
Uniqueness: 99.59% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.09%
rdkit pharmacophore match: 68.95%
rdkit valid pharmacophore match: 67.56%
pgmg pharmacophore match: 78.07%
pgmg valid pharmacophore match: 77.83%
pgmg pharmacophore match percentage: 68.95%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.014, 'sampling/AtomTypesTV': 0.143, 'sampling/EdgeTypesTV': 0.07, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.056, 'sampling/BondLengthsW1': 0.014, 'sampling/AnglesW1': 7.256}
Sampling metrics done.
Val epoch 119 ends
Train epoch 119 ends
Epoch 119 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 524.2s 
Starting epoch 120
Train epoch 120 ends
Epoch 120 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 121
Train epoch 121 ends
Epoch 121 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 122
Train epoch 122 ends
Epoch 122 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 123
Train epoch 123 ends
Epoch 123 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 124
Train epoch 124 ends
Epoch 124 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.0s 
Starting epoch 125
Train epoch 125 ends
Epoch 125 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 126
Train epoch 126 ends
Epoch 126 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 99.2s 
Starting epoch 127
Train epoch 127 ends
Epoch 127 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.6s 
Starting epoch 128
Train epoch 128 ends
Epoch 128 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.7s 
Starting epoch 129
Train epoch 129 ends
Epoch 129 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 130
Train epoch 130 ends
Epoch 130 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 131
Train epoch 131 ends
Epoch 131 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 132
Train epoch 132 ends
Epoch 132 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 133
Train epoch 133 ends
Epoch 133 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 134
Train epoch 134 ends
Epoch 134 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 135
Train epoch 135 ends
Epoch 135 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 136
Train epoch 136 ends
Epoch 136 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 137
Train epoch 137 ends
Epoch 137 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.7s 
Starting epoch 138
Train epoch 138 ends
Epoch 138 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 139
Epoch 139: val/epoch_NLL: 397624.78 -- val/pos_mse: 397364.31 -- val/X_kl: 2221.58 -- val/E_kl: 2425.03 -- val/charges_kl: 510.22 
Val loss: 397624.7812 	 Best val loss:  397624.7812

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch139/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 399.86 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 36, Kekulize 0, other 0,  -- No error 988
Validity over 1024 molecules: 96.48%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 97.75
Uniqueness: 98.79% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.87%
rdkit pharmacophore match: 74.51%
rdkit valid pharmacophore match: 72.77%
pgmg pharmacophore match: 78.14%
pgmg valid pharmacophore match: 77.79%
pgmg pharmacophore match percentage: 68.84%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.023, 'sampling/AtomTypesTV': 0.127, 'sampling/EdgeTypesTV': 0.065, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.058, 'sampling/BondLengthsW1': 0.008, 'sampling/AnglesW1': 6.86}
Sampling metrics done.
Val epoch 139 ends
Train epoch 139 ends
Epoch 139 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 521.6s 
Starting epoch 140
Train epoch 140 ends
Epoch 140 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.9s 
Starting epoch 141
Train epoch 141 ends
Epoch 141 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.9s 
Starting epoch 142
Train epoch 142 ends
Epoch 142 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 99.8s 
Starting epoch 143
Train epoch 143 ends
Epoch 143 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 144
Train epoch 144 ends
Epoch 144 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 145
Train epoch 145 ends
Epoch 145 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 146
Train epoch 146 ends
Epoch 146 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 147
Train epoch 147 ends
Epoch 147 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 148
Train epoch 148 ends
Epoch 148 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 149
Train epoch 149 ends
Epoch 149 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 150
Train epoch 150 ends
Epoch 150 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 151
Train epoch 151 ends
Epoch 151 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 152
Train epoch 152 ends
Epoch 152 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 153
Train epoch 153 ends
Epoch 153 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 154
Train epoch 154 ends
Epoch 154 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 155
Train epoch 155 ends
Epoch 155 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 156
Train epoch 156 ends
Epoch 156 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.3s 
Starting epoch 157
Train epoch 157 ends
Epoch 157 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.6s 
Starting epoch 158
Train epoch 158 ends
Epoch 158 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 159
Epoch 159: val/epoch_NLL: 344329.09 -- val/pos_mse: 344060.00 -- val/X_kl: 2239.85 -- val/E_kl: 2473.25 -- val/charges_kl: 602.26 
Val loss: 344329.0938 	 Best val loss:  344329.0938

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch159/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 401.57 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 50, Kekulize 2, other 0,  -- No error 972
Validity over 1024 molecules: 94.92%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 99.32
Uniqueness: 98.97% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.76%
rdkit pharmacophore match: 68.91%
rdkit valid pharmacophore match: 67.66%
pgmg pharmacophore match: 77.70%
pgmg valid pharmacophore match: 77.22%
pgmg pharmacophore match percentage: 68.25%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.02, 'sampling/AtomTypesTV': 0.184, 'sampling/EdgeTypesTV': 0.066, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.102, 'sampling/BondLengthsW1': 0.02, 'sampling/AnglesW1': 6.297}
Sampling metrics done.
Val epoch 159 ends
Train epoch 159 ends
Epoch 159 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 520.7s 
Starting epoch 160
Train epoch 160 ends
Epoch 160 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.9s 
Starting epoch 161
Train epoch 161 ends
Epoch 161 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 162
Train epoch 162 ends
Epoch 162 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 163
Train epoch 163 ends
Epoch 163 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 164
Train epoch 164 ends
Epoch 164 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 165
Train epoch 165 ends
Epoch 165 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 166
Train epoch 166 ends
Epoch 166 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 167
Train epoch 167 ends
Epoch 167 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 168
Train epoch 168 ends
Epoch 168 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 169
Train epoch 169 ends
Epoch 169 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 170
Train epoch 170 ends
Epoch 170 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 171
Train epoch 171 ends
Epoch 171 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 172
Train epoch 172 ends
Epoch 172 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.0s 
Starting epoch 173
Train epoch 173 ends
Epoch 173 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.5s 
Starting epoch 174
Train epoch 174 ends
Epoch 174 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 175
Train epoch 175 ends
Epoch 175 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.0s 
Starting epoch 176
Train epoch 176 ends
Epoch 176 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 177
Train epoch 177 ends
Epoch 177 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.4s 
Starting epoch 178
Train epoch 178 ends
Epoch 178 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 179
Epoch 179: val/epoch_NLL: 353145.59 -- val/pos_mse: 352886.41 -- val/X_kl: 2246.95 -- val/E_kl: 2362.22 -- val/charges_kl: 514.16 
Val loss: 353145.5938 	 Best val loss:  344329.0938

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch179/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 410.61 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 21, Kekulize 1, other 0,  -- No error 1002
Validity over 1024 molecules: 97.85%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 98.93
Uniqueness: 98.20% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.52%
rdkit pharmacophore match: 67.77%
rdkit valid pharmacophore match: 66.67%
pgmg pharmacophore match: 77.25%
pgmg valid pharmacophore match: 76.70%
pgmg pharmacophore match percentage: 67.72%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.029, 'sampling/AtomTypesTV': 0.151, 'sampling/EdgeTypesTV': 0.063, 'sampling/ChargeW1': 0.009, 'sampling/ValencyW1': 0.082, 'sampling/BondLengthsW1': 0.011, 'sampling/AnglesW1': 7.002}
Sampling metrics done.
Val epoch 179 ends
Train epoch 179 ends
Epoch 179 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 529.0s 
Starting epoch 180
Train epoch 180 ends
Epoch 180 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 181
Train epoch 181 ends
Epoch 181 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 182
Train epoch 182 ends
Epoch 182 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 183
Train epoch 183 ends
Epoch 183 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 184
Train epoch 184 ends
Epoch 184 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 185
Train epoch 185 ends
Epoch 185 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 186
Train epoch 186 ends
Epoch 186 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 187
Train epoch 187 ends
Epoch 187 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.8s 
Starting epoch 188
Train epoch 188 ends
Epoch 188 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.9s 
Starting epoch 189
Train epoch 189 ends
Epoch 189 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 190
Train epoch 190 ends
Epoch 190 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 191
Train epoch 191 ends
Epoch 191 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 192
Train epoch 192 ends
Epoch 192 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 193
Train epoch 193 ends
Epoch 193 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 194
Train epoch 194 ends
Epoch 194 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 195
Train epoch 195 ends
Epoch 195 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.5s 
Starting epoch 196
Train epoch 196 ends
Epoch 196 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 197
Train epoch 197 ends
Epoch 197 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.0s 
Starting epoch 198
Train epoch 198 ends
Epoch 198 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 199
Epoch 199: val/epoch_NLL: 275389.94 -- val/pos_mse: 275139.97 -- val/X_kl: 2116.48 -- val/E_kl: 2363.89 -- val/charges_kl: 459.89 
Val loss: 275389.9375 	 Best val loss:  275389.9375

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch199/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 408.06 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 24, Kekulize 0, other 0,  -- No error 1000
Validity over 1024 molecules: 97.66%
Number of connected components of 1024 molecules: mean:1.00 max:2.00
Connected components of 1024 molecules: 99.61
Uniqueness: 98.30% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 2.29%
rdkit pharmacophore match: 67.97%
rdkit valid pharmacophore match: 66.30%
pgmg pharmacophore match: 76.87%
pgmg valid pharmacophore match: 76.19%
pgmg pharmacophore match percentage: 67.29%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.019, 'sampling/AtomTypesTV': 0.177, 'sampling/EdgeTypesTV': 0.065, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.086, 'sampling/BondLengthsW1': 0.014, 'sampling/AnglesW1': 6.417}
Sampling metrics done.
Val epoch 199 ends
Train epoch 199 ends
Epoch 199 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 530.1s 
Starting epoch 200
Train epoch 200 ends
Epoch 200 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 201
Train epoch 201 ends
Epoch 201 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 202
Train epoch 202 ends
Epoch 202 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 203
Train epoch 203 ends
Epoch 203 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 204
Train epoch 204 ends
Epoch 204 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 205
Train epoch 205 ends
Epoch 205 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 206
Train epoch 206 ends
Epoch 206 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 207
Train epoch 207 ends
Epoch 207 finished: pos: 0.21 -- X: 0.19 -- charges: 0.04 -- E: 0.20 -- y: -1.00 -- 96.7s 
Starting epoch 208
Train epoch 208 ends
Epoch 208 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 209
Train epoch 209 ends
Epoch 209 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 210
Train epoch 210 ends
Epoch 210 finished: pos: 0.21 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 211
Train epoch 211 ends
Epoch 211 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 212
Train epoch 212 ends
Epoch 212 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 213
Train epoch 213 ends
Epoch 213 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.5s 
Starting epoch 214
Train epoch 214 ends
Epoch 214 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 215
Train epoch 215 ends
Epoch 215 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.5s 
Starting epoch 216
Train epoch 216 ends
Epoch 216 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 217
Train epoch 217 ends
Epoch 217 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 218
Train epoch 218 ends
Epoch 218 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 219
Epoch 219: val/epoch_NLL: 297203.28 -- val/pos_mse: 296951.69 -- val/X_kl: 2083.80 -- val/E_kl: 2391.71 -- val/charges_kl: 492.01 
Val loss: 297203.2812 	 Best val loss:  275389.9375

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch219/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 408.90 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 25, Kekulize 0, other 0,  -- No error 999
Validity over 1024 molecules: 97.56%
Number of connected components of 1024 molecules: mean:1.00 max:2.00
Connected components of 1024 molecules: 99.71
Uniqueness: 99.20% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
conformer pharmacophore match: 3.79%
rdkit pharmacophore match: 71.29%
rdkit valid pharmacophore match: 69.67%
pgmg pharmacophore match: 76.84%
pgmg valid pharmacophore match: 76.11%
pgmg pharmacophore match percentage: 67.24%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.017, 'sampling/AtomTypesTV': 0.148, 'sampling/EdgeTypesTV': 0.074, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.075, 'sampling/BondLengthsW1': 0.011, 'sampling/AnglesW1': 7.406}
Sampling metrics done.
Val epoch 219 ends
Train epoch 219 ends
Epoch 219 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 527.8s 
Starting epoch 220
Train epoch 220 ends
Epoch 220 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.8s 
Starting epoch 221
Train epoch 221 ends
Epoch 221 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 222
Train epoch 222 ends
Epoch 222 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.7s 
Starting epoch 223
Train epoch 223 ends
Epoch 223 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.6s 
Starting epoch 224
Train epoch 224 ends
Epoch 224 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 225
Train epoch 225 ends
Epoch 225 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.3s 
Starting epoch 226
Train epoch 226 ends
Epoch 226 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.4s 
Starting epoch 227
Train epoch 227 ends
Epoch 227 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.5s 
Starting epoch 228
Train epoch 228 ends
Epoch 228 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 98.9s 
Starting epoch 229
Train epoch 229 ends
Epoch 229 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.2s 
Starting epoch 230
Train epoch 230 ends
Epoch 230 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.3s 
Starting epoch 231
Train epoch 231 ends
Epoch 231 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 232
Train epoch 232 ends
Epoch 232 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.20 -- y: -1.00 -- 95.2s 
Starting epoch 233
Train epoch 233 ends
Epoch 233 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.1s 
Starting epoch 234
Train epoch 234 ends
Epoch 234 finished: pos: 0.21 -- X: 0.19 -- charges: 0.04 -- E: 0.20 -- y: -1.00 -- 96.0s 
Starting epoch 235
Train epoch 235 ends
Epoch 235 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.2s 
Starting epoch 236
Train epoch 236 ends
Epoch 236 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 237
Train epoch 237 ends
Epoch 237 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 95.3s 
Starting epoch 238
Train epoch 238 ends
Epoch 238 finished: pos: 0.22 -- X: 0.19 -- charges: 0.04 -- E: 0.21 -- y: -1.00 -- 96.1s 
Starting epoch 239
Epoch 239: val/epoch_NLL: 349281.56 -- val/pos_mse: 349034.03 -- val/X_kl: 2082.99 -- val/E_kl: 2288.42 -- val/charges_kl: 522.78 
Val loss: 349281.5625 	 Best val loss:  275389.9375

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-10/22-52-03-noh_ada3/chains/epoch239/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 421.07 seconds

Computing sampling metrics on 0...
Global seed set to 0
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 0
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81168, 8: 13156, 7: 2240, 6: 443, 5: 76, 4: 17, 3: 5, 2: 2})
NUM NODES IN STATISTICS Counter({9: 16558, 8: 2764, 7: 488, 6: 68, 5: 18, 4: 6, 3: 1})
NUM NODES IN STATISTICS Counter({9: 10791, 8: 1798, 7: 304, 6: 68, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7245, 0.1132, 0.1597, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-07-11 08:03:39,547][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-07-11 08:03:39,548][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.1 M
----------------------------------------------------------------
20.1 M    Trainable params
0         Non-trainable params
20.1 M    Total params
80.338    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.17.4 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-07-11/08-02-35-noh_ada3/wandb/run-20240711_080341-04gsuvwy
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/04gsuvwy
Epoch 0: val/epoch_NLL: 1407216768.00 -- val/pos_mse: 1407211776.00 -- val/X_kl: 2337.01 -- val/E_kl: 4401.67 -- val/charges_kl: 3340.25 
Val loss: 1407216768.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Error executing job with overrides: ['dataset=qm9', 'dataset.remove_h=True', '+experiment=qm9_no_h_adaptive']
Traceback (most recent call last):
  File "/home/amira/midi_two/MiDi/midi/main.py", line 101, in main
    trainer.fit(model, datamodule=datamodule, ckpt_path=cfg.general.resume)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    self.fit_loop.run()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 218, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 185, in run
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 260, in _optimizer_step
    call._call_lightning_module_hook(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 140, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/core/module.py", line 1256, in optimizer_step
    optimizer.step(closure=optimizer_closure)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/core/optimizer.py", line 155, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/ddp.py", line 256, in optimizer_step
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 225, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/plugins/precision/precision_plugin.py", line 114, in optimizer_step
    return optimizer.step(closure=closure, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    out = func(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    ret = func(self, *args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/optim/adamw.py", line 148, in step
    loss = closure()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
    closure_result = closure()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 140, in __call__
    self._result = self.closure(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 126, in closure
    step_output = self._step_fn()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 307, in _training_step
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/ddp.py", line 328, in training_step
    return self.model(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 108, in training_step
    loss, tl_log_dict = self.train_loss(masked_pred=pred, masked_true=dense_data,
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/metrics/train_metrics.py", line 66, in forward
    self.lambda_train[4] * loss_y + self.lambda_train[5] * loss_pharma_coord)
omegaconf.errors.ConfigIndexError: list index out of range
    full_key: model.lambda_train[5]
    object_type=list

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: - 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: \ 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: | 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: / 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: - 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: 
wandb: Run history:
wandb:       val/E_kl ‚ñÅ
wandb:       val/X_kl ‚ñÅ
wandb: val/charges_kl ‚ñÅ
wandb:  val/epoch_NLL ‚ñÅ
wandb:    val/pos_mse ‚ñÅ
wandb: 
wandb: Run summary:
wandb:       val/E_kl 4401.66553
wandb:       val/X_kl 2337.01172
wandb: val/charges_kl 3340.24585
wandb:  val/epoch_NLL 1407216768.0
wandb:    val/pos_mse 1407211776.0
wandb: 
wandb: üöÄ View run noh_ada3 at: https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/04gsuvwy
wandb: Synced 6 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240711_080341-04gsuvwy/logs
Global seed set to 0
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 0
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81168, 8: 13156, 7: 2240, 6: 443, 5: 76, 4: 17, 3: 5, 2: 2})
NUM NODES IN STATISTICS Counter({9: 16558, 8: 2764, 7: 488, 6: 68, 5: 18, 4: 6, 3: 1})
NUM NODES IN STATISTICS Counter({9: 10791, 8: 1798, 7: 304, 6: 68, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7245, 0.1132, 0.1597, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-07-12 10:33:40,298][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-07-12 10:33:40,298][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.1 M
----------------------------------------------------------------
20.1 M    Trainable params
0         Non-trainable params
20.1 M    Total params
80.338    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.17.4 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-07-12/10-32-34-noh_ada3/wandb/run-20240712_103342-87jiwzuq
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/87jiwzuq
Epoch 0: val/epoch_NLL: 1407216768.00 -- val/pos_mse: 1407211776.00 -- val/X_kl: 2337.01 -- val/E_kl: 4401.67 -- val/charges_kl: 3340.25 
Val loss: 1407216768.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Global seed set to 0
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 0
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81168, 8: 13156, 7: 2240, 6: 443, 5: 76, 4: 17, 3: 5, 2: 2})
NUM NODES IN STATISTICS Counter({9: 16558, 8: 2764, 7: 488, 6: 68, 5: 18, 4: 6, 3: 1})
NUM NODES IN STATISTICS Counter({9: 10791, 8: 1798, 7: 304, 6: 68, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7245, 0.1132, 0.1597, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-07-12 10:42:34,064][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-07-12 10:42:34,064][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.1 M
----------------------------------------------------------------
20.1 M    Trainable params
0         Non-trainable params
20.1 M    Total params
80.338    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.17.4 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-07-12/10-41-27-noh_ada3/wandb/run-20240712_104237-okxa9yzd
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/okxa9yzd
/home/amira/midi_two/MiDi/midi/metrics/molecular_metrics.py:593: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at ../torch/csrc/utils/tensor_new.cpp:245.)
  coord_arr = torch.tensor(coord_arr).float().to(device)
Train epoch 0 ends
Epoch 0 finished: pos: 0.73 -- X: 0.63 -- charges: 0.13 -- E: 0.56 -- y: -1.00 -- 128.7s 
Starting epoch 1
Train epoch 1 ends
Epoch 1 finished: pos: 0.41 -- X: 0.59 -- charges: 0.12 -- E: 0.37 -- y: -1.00 -- 149.4s 
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: pos: 0.30 -- X: 0.48 -- charges: 0.11 -- E: 0.32 -- y: -1.00 -- 193.6s 
Starting epoch 3
Train epoch 3 ends
Epoch 3 finished: pos: 0.27 -- X: 0.33 -- charges: 0.08 -- E: 0.29 -- y: -1.00 -- 96.8s 
Starting epoch 4
Train epoch 4 ends
Epoch 4 finished: pos: 0.26 -- X: 0.29 -- charges: 0.07 -- E: 0.28 -- y: -1.00 -- 130.2s 
Starting epoch 5
Train epoch 5 ends
Epoch 5 finished: pos: 0.25 -- X: 0.27 -- charges: 0.07 -- E: 0.27 -- y: -1.00 -- 218.1s 
Starting epoch 6
Train epoch 6 ends
Epoch 6 finished: pos: 0.25 -- X: 0.26 -- charges: 0.06 -- E: 0.26 -- y: -1.00 -- 217.9s 
Starting epoch 7
Train epoch 7 ends
Epoch 7 finished: pos: 0.25 -- X: 0.25 -- charges: 0.06 -- E: 0.26 -- y: -1.00 -- 218.6s 
Starting epoch 8
Train epoch 8 ends
Epoch 8 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 217.4s 
Starting epoch 9
Train epoch 9 ends
Epoch 9 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 217.6s 
Starting epoch 10
Train epoch 10 ends
Epoch 10 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 219.5s 
Starting epoch 11
Train epoch 11 ends
Epoch 11 finished: pos: 0.24 -- X: 0.24 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 219.2s 
Starting epoch 12
Train epoch 12 ends
Epoch 12 finished: pos: 0.24 -- X: 0.23 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 219.2s 
Starting epoch 13
Train epoch 13 ends
Epoch 13 finished: pos: 0.24 -- X: 0.23 -- charges: 0.06 -- E: 0.24 -- y: -1.00 -- 219.9s 
Starting epoch 14
Train epoch 14 ends
Epoch 14 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 221.7s 
Starting epoch 15
Train epoch 15 ends
Epoch 15 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 222.1s 
Starting epoch 16
Train epoch 16 ends
Epoch 16 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 222.9s 
Starting epoch 17
Train epoch 17 ends
Epoch 17 finished: pos: 0.24 -- X: 0.22 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 220.8s 
Starting epoch 18
Train epoch 18 ends
Epoch 18 finished: pos: 0.23 -- X: 0.22 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 220.3s 
Starting epoch 19
Epoch 19: val/epoch_NLL: 3366367.00 -- val/pos_mse: 3366031.75 -- val/X_kl: 2784.11 -- val/E_kl: 3063.47 -- val/charges_kl: 801.94 
Val loss: 3366367.0000 	 Best val loss:  3366367.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-07-12/10-32-34-noh_ada3/chains/epoch19/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 722.46 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 154, Kekulize 22, other 4,  -- No error 844
Error executing job with overrides: ['dataset=qm9', 'dataset.remove_h=True', '+experiment=qm9_no_h_adaptive']
Traceback (most recent call last):
  File "/home/amira/midi_two/MiDi/midi/main.py", line 101, in main
    trainer.fit(model, datamodule=datamodule, ckpt_path=cfg.general.resume)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1018, in _run_stage
    self.fit_loop.run()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 134, in run
    self.on_advance_end()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 248, in on_advance_end
    self.val_loop.run()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 177, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 122, in run
    return self.on_run_end()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 244, in on_run_end
    self._on_evaluation_epoch_end()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 326, in _on_evaluation_epoch_end
    call._call_lightning_module_hook(trainer, hook_name)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 140, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 172, in on_validation_epoch_end
    self.val_sampling_metrics(samples, self.name, self.current_epoch, self.local_rank)
  File "/home/amira/midi_two/MiDi/midi/metrics/molecular_metrics.py", line 197, in __call__
    all_generated_smiles = self.evaluate(molecules, local_rank=local_rank)
  File "/home/amira/midi_two/MiDi/midi/metrics/molecular_metrics.py", line 136, in evaluate
    self.conf_pharma_satisfaction(generated, th=1)
  File "/home/amira/midi_two/MiDi/midi/metrics/molecular_metrics.py", line 288, in conf_pharma_satisfaction
    fraction_satisfied = checkPharmacophoreSatisfaction(mol, ref_labels, ref_coords, th)
  File "/home/amira/midi_two/MiDi/midi/metrics/molecular_metrics.py", line 593, in checkPharmacophoreSatisfaction
    coord_arr = torch.tensor(coord_arr).float().to(device)
ValueError: expected sequence of length 1 at dim 1 (got 3)

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: 
wandb: Run history:
wandb:                  epoch ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÑ‚ñÖ‚ñÖ‚ñÖ‚ñÜ‚ñÜ‚ñÜ‚ñá‚ñá‚ñà‚ñà
wandb:       train_epoch/E_CE ‚ñà‚ñÑ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb: train_epoch/charges_CE ‚ñà‚ñá‚ñÜ‚ñÉ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:    train_epoch/pos_mse ‚ñà‚ñÉ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:       train_epoch/x_CE ‚ñà‚ñá‚ñÜ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:       train_epoch/y_CE ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:        train_loss/E_CE ‚ñà‚ñÑ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:        train_loss/X_CE ‚ñà‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÑ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:  train_loss/batch_loss ‚ñà‚ñÉ‚ñÉ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:  train_loss/charges_CE ‚ñà‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:     train_loss/pos_mse ‚ñà‚ñÑ‚ñÉ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:        train_loss/y_CE ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:               val/E_kl ‚ñà‚ñÅ
wandb:               val/X_kl ‚ñÅ‚ñà
wandb:         val/charges_kl ‚ñà‚ñÅ
wandb:          val/epoch_NLL ‚ñà‚ñÅ
wandb:            val/pos_mse ‚ñà‚ñÅ
wandb: 
wandb: Run summary:
wandb:                  epoch 18
wandb:       train_epoch/E_CE 0.23461
wandb: train_epoch/charges_CE 0.05193
wandb:    train_epoch/pos_mse 0.23398
wandb:       train_epoch/x_CE 0.2232
wandb:       train_epoch/y_CE -1.0
wandb:        train_loss/E_CE 0.47511
wandb:        train_loss/X_CE 0.08971
wandb:  train_loss/batch_loss 1.75015
wandb:  train_loss/charges_CE 0.05202
wandb:     train_loss/pos_mse 1.1897
wandb:        train_loss/y_CE -1.0
wandb:               val/E_kl 3063.46875
wandb:               val/X_kl 2784.11426
wandb:         val/charges_kl 801.93762
wandb:          val/epoch_NLL 3366367.0
wandb:            val/pos_mse 3366031.75
wandb: 
wandb: üöÄ View run noh_ada3 at: https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/87jiwzuq
wandb: Synced 6 W&B file(s), 21 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240712_103342-87jiwzuq/logs
In 'config': Could not find 'experiment/'

Available options in 'experiment':
	dataset_analysis
	debug
	geom
	geom_no_h_adaptive
	geom_no_h_uniform
	geom_with_h
	geom_with_h_adaptive
	geom_with_h_uniform
	qm9_no_h_adaptive
	qm9_no_h_uniform
	qm9_with_h_adaptive
	qm9_with_h_uniform
Config search path:
	provider=hydra, path=pkg://hydra.conf
	provider=main, path=file:///home/amira/midi_two/MiDi/configs
	provider=schema, path=structured://

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
Traceback (most recent call last):
  File "/home/amira/midi_two/MiDi/midi/main.py", line 122, in <module>
    main()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/utils.py", line 393, in _run_hydra
    run_mode = hydra.get_mode(config_name=config_name, overrides=overrides)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/hydra.py", line 87, in get_mode
    cfg = self.compose_config(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/hydra.py", line 594, in compose_config
    cfg = self.config_loader.load_configuration(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/config_loader_impl.py", line 142, in load_configuration
    return self._load_configuration_impl(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/config_loader_impl.py", line 253, in _load_configuration_impl
    defaults_list = create_defaults_list(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 745, in create_defaults_list
    defaults, tree = _create_defaults_list(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 715, in _create_defaults_list
    defaults_tree = _create_defaults_tree(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 356, in _create_defaults_tree
    ret = _create_defaults_tree_impl(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 457, in _create_defaults_tree_impl
    return _expand_virtual_root(repo, root, overrides, skip_missing)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 280, in _expand_virtual_root
    subtree = _create_defaults_tree_impl(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 573, in _create_defaults_tree_impl
    add_child(children, new_root)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 520, in add_child
    subtree_ = _create_defaults_tree_impl(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 466, in _create_defaults_tree_impl
    update_package_header(repo=repo, node=parent)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/defaults_list.py", line 262, in update_package_header
    loaded = repo.load_config(config_path=node.get_config_path())
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/config_repository.py", line 348, in load_config
    ret = self.delegate.load_config(config_path=config_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/config_repository.py", line 91, in load_config
    ret = source.load_config(config_path=config_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/core_plugins/importlib_resources_config_source.py", line 60, in load_config
    return self._read_config(res)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/hydra/_internal/core_plugins/importlib_resources_config_source.py", line 44, in _read_config
    cfg = OmegaConf.load(f)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/omegaconf.py", line 205, in load
    ret = OmegaConf.create(obj)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/omegaconf.py", line 178, in create
    return OmegaConf._create_impl(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/omegaconf.py", line 861, in _create_impl
    return DictConfig(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/dictconfig.py", line 109, in __init__
    self._set_value(content, flags=flags)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/dictconfig.py", line 644, in _set_value
    self._set_value_impl(value, flags)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/dictconfig.py", line 690, in _set_value_impl
    self.__setitem__(k, v)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/dictconfig.py", line 308, in __setitem__
    self.__set_impl(key=key, value=value)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/dictconfig.py", line 318, in __set_impl
    self._set_item_impl(key, value)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/basecontainer.py", line 590, in _set_item_impl
    special_value = _is_special(value)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/omegaconf/_utils.py", line 597, in _is_special
    def _is_special(value: Any) -> bool:
KeyboardInterrupt
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-20 02:46:45,286][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-20 02:46:45,286][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 49.2 M
----------------------------------------------------------------
49.2 M    Trainable params
0         Non-trainable params
49.2 M    Total params
196.669   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-20/02-45-40-noh_ada3/wandb/run-20241020_024647-625cio4j
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/625cio4j
Epoch 0: val/epoch_NLL: 1218849024.00 -- val/pos_mse: 1218844416.00 -- val/X_kl: 3792.03 -- val/E_kl: 3280.85 -- val/charges_kl: 2410.61 
Val loss: 1218849024.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Train epoch 0 ends
Epoch 0 finished: pos: 0.42 -- X: 0.41 -- charges: 0.10 -- E: 0.52 -- y: -1.00 -- 163.9s 
Starting epoch 1
Train epoch 1 ends
Epoch 1 finished: pos: 0.27 -- X: 0.28 -- charges: 0.07 -- E: 0.37 -- y: -1.00 -- 166.3s 
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: pos: 0.25 -- X: 0.26 -- charges: 0.06 -- E: 0.31 -- y: -1.00 -- 161.2s 
Starting epoch 3
Train epoch 3 ends
Epoch 3 finished: pos: 0.25 -- X: 0.25 -- charges: 0.06 -- E: 0.28 -- y: -1.00 -- 161.0s 
Starting epoch 4
Train epoch 4 ends
Epoch 4 finished: pos: 0.24 -- X: 0.24 -- charges: 0.05 -- E: 0.27 -- y: -1.00 -- 160.9s 
Starting epoch 5
Train epoch 5 ends
Epoch 5 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 161.1s 
Starting epoch 6
Train epoch 6 ends
Epoch 6 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 164.3s 
Starting epoch 7
Train epoch 7 ends
Epoch 7 finished: pos: 0.24 -- X: 0.22 -- charges: 0.04 -- E: 0.25 -- y: -1.00 -- 163.1s 
Starting epoch 8
Train epoch 8 ends
Epoch 8 finished: pos: 0.24 -- X: 0.21 -- charges: 0.04 -- E: 0.25 -- y: -1.00 -- 160.7s 
Starting epoch 9
Epoch 9: val/epoch_NLL: 9740635.00 -- val/pos_mse: 9740295.00 -- val/X_kl: 2556.30 -- val/E_kl: 3477.34 -- val/charges_kl: 649.53 
Val loss: 9740635.0000 	 Best val loss:  9740635.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/02-45-40-noh_ada3/chains/epoch9/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 543.38 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 566, Kekulize 11, other 4,  -- No error 443
Validity over 1024 molecules: 43.26%
Number of connected components of 1024 molecules: mean:1.12 max:3.00
Connected components of 1024 molecules: 88.18
Uniqueness: 99.77% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 44.53%
rdkit valid pharmacophore match: 54.18%
rdkit pharmacophore match 2d: 74.12%
rdkit valid pharmacophore match 2d: 80.36%
pgmg pharmacophore match: 50.73%
pgmg valid pharmacophore match: 59.22%
pgmg pharmacophore match percentage: 34.96%
pgmg valid pharmacophore match percentage: 43.57%
Sparsity level on local rank 0: 71 %
Sampling metrics {'sampling/NumNodesW1': 0.011, 'sampling/AtomTypesTV': 0.081, 'sampling/EdgeTypesTV': 0.029, 'sampling/ChargeW1': 0.002, 'sampling/ValencyW1': 0.264, 'sampling/BondLengthsW1': 0.034, 'sampling/AnglesW1': 12.233}
Sampling metrics done.
Val epoch 9 ends
Train epoch 9 ends
Epoch 9 finished: pos: 0.24 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 733.2s 
Starting epoch 10
Train epoch 10 ends
Epoch 10 finished: pos: 0.24 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 161.4s 
Starting epoch 11
Train epoch 11 ends
Epoch 11 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 160.6s 
Starting epoch 12
Train epoch 12 ends
Epoch 12 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 160.8s 
Starting epoch 13
Train epoch 13 ends
Epoch 13 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 161.0s 
Starting epoch 14
Train epoch 14 ends
Epoch 14 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 164.0s 
Starting epoch 15
Train epoch 15 ends
Epoch 15 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 162.9s 
Starting epoch 16
Train epoch 16 ends
Epoch 16 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 161.0s 
Starting epoch 17
Train epoch 17 ends
Epoch 17 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 160.7s 
Starting epoch 18
Train epoch 18 ends
Epoch 18 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 163.1s 
Starting epoch 19
Epoch 19: val/epoch_NLL: 9889878.00 -- val/pos_mse: 9889539.00 -- val/X_kl: 2537.64 -- val/E_kl: 3344.73 -- val/charges_kl: 783.73 
Val loss: 9889878.0000 	 Best val loss:  9740635.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/02-45-40-noh_ada3/chains/epoch19/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 548.74 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 481, Kekulize 2, other 0,  -- No error 541
Validity over 1024 molecules: 52.83%
Number of connected components of 1024 molecules: mean:1.11 max:3.00
Connected components of 1024 molecules: 89.36
Uniqueness: 100.00% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 48.14%
rdkit valid pharmacophore match: 53.97%
rdkit pharmacophore match 2d: 75.20%
rdkit valid pharmacophore match 2d: 81.33%
pgmg pharmacophore match: 53.12%
pgmg valid pharmacophore match: 60.26%
pgmg pharmacophore match percentage: 37.11%
pgmg valid pharmacophore match percentage: 44.55%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.006, 'sampling/AtomTypesTV': 0.181, 'sampling/EdgeTypesTV': 0.061, 'sampling/ChargeW1': 0.007, 'sampling/ValencyW1': 0.224, 'sampling/BondLengthsW1': 0.032, 'sampling/AnglesW1': 9.619}
Sampling metrics done.
Val epoch 19 ends
Train epoch 19 ends
Epoch 19 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 739.8s 
Starting epoch 20
Train epoch 20 ends
Epoch 20 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 161.1s 
Starting epoch 21
Train epoch 21 ends
Epoch 21 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 160.7s 
Starting epoch 22
Train epoch 22 ends
Epoch 22 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 160.6s 
Starting epoch 23
Train epoch 23 ends
Epoch 23 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.2s 
Starting epoch 24
Train epoch 24 ends
Epoch 24 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 164.1s 
Starting epoch 25
Train epoch 25 ends
Epoch 25 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 161.9s 
Starting epoch 26
Train epoch 26 ends
Epoch 26 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 160.9s 
Starting epoch 27
Train epoch 27 ends
Epoch 27 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 160.7s 
Starting epoch 28
Train epoch 28 ends
Epoch 28 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 160.8s 
Starting epoch 29
Epoch 29: val/epoch_NLL: 3952545.75 -- val/pos_mse: 3952250.00 -- val/X_kl: 2250.77 -- val/E_kl: 3066.58 -- val/charges_kl: 479.36 
Val loss: 3952545.7500 	 Best val loss:  3952545.7500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/02-45-40-noh_ada3/chains/epoch29/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 550.27 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 346, Kekulize 1, other 1,  -- No error 676
Validity over 1024 molecules: 66.02%
Number of connected components of 1024 molecules: mean:1.08 max:3.00
Connected components of 1024 molecules: 92.38
Uniqueness: 99.26% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 50.10%
rdkit valid pharmacophore match: 55.92%
rdkit pharmacophore match 2d: 74.41%
Global seed set to 42
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-20 05:16:16,062][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-20 05:16:16,063][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 49.2 M
----------------------------------------------------------------
49.2 M    Trainable params
0         Non-trainable params
49.2 M    Total params
196.669   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-20/05-15-10-noh_ada3/wandb/run-20241020_051618-qj2pgdtl
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/qj2pgdtl
Epoch 0: val/epoch_NLL: 1359592576.00 -- val/pos_mse: 1359588096.00 -- val/X_kl: 3126.85 -- val/E_kl: 3360.98 -- val/charges_kl: 2414.08 
Val loss: 1359592576.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-20 05:26:18,977][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-20 05:26:18,977][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 49.2 M
----------------------------------------------------------------
49.2 M    Trainable params
0         Non-trainable params
49.2 M    Total params
196.669   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/wandb/run-20241020_052620-p5qqzrot
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/p5qqzrot
Epoch 0: val/epoch_NLL: 1347371264.00 -- val/pos_mse: 1347366784.00 -- val/X_kl: 3182.54 -- val/E_kl: 3406.46 -- val/charges_kl: 2380.98 
Val loss: 1347371264.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Train epoch 0 ends
Epoch 0 finished: pos: 0.49 -- X: 0.57 -- charges: 0.20 -- E: 0.54 -- y: -1.00 -- 162.6s 
Starting epoch 1
Train epoch 1 ends
Epoch 1 finished: pos: 0.28 -- X: 0.45 -- charges: 0.10 -- E: 0.38 -- y: -1.00 -- 167.3s 
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: pos: 0.26 -- X: 0.37 -- charges: 0.08 -- E: 0.33 -- y: -1.00 -- 162.6s 
Starting epoch 3
Train epoch 3 ends
Epoch 3 finished: pos: 0.25 -- X: 0.29 -- charges: 0.06 -- E: 0.30 -- y: -1.00 -- 162.4s 
Starting epoch 4
Train epoch 4 ends
Epoch 4 finished: pos: 0.24 -- X: 0.26 -- charges: 0.05 -- E: 0.28 -- y: -1.00 -- 161.9s 
Starting epoch 5
Train epoch 5 ends
Epoch 5 finished: pos: 0.24 -- X: 0.23 -- charges: 0.05 -- E: 0.27 -- y: -1.00 -- 163.0s 
Starting epoch 6
Train epoch 6 ends
Epoch 6 finished: pos: 0.24 -- X: 0.22 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 164.6s 
Starting epoch 7
Train epoch 7 ends
Epoch 7 finished: pos: 0.24 -- X: 0.21 -- charges: 0.04 -- E: 0.26 -- y: -1.00 -- 164.0s 
Starting epoch 8
Train epoch 8 ends
Epoch 8 finished: pos: 0.24 -- X: 0.21 -- charges: 0.04 -- E: 0.25 -- y: -1.00 -- 162.6s 
Starting epoch 9
Epoch 9: val/epoch_NLL: 11477004.00 -- val/pos_mse: 11476651.00 -- val/X_kl: 2707.79 -- val/E_kl: 3611.41 -- val/charges_kl: 642.98 
Val loss: 11477004.0000 	 Best val loss:  11477004.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch9/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 543.14 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 478, Kekulize 22, other 17,  -- No error 507
Validity over 1024 molecules: 49.51%
Number of connected components of 1024 molecules: mean:1.30 max:4.00
Connected components of 1024 molecules: 73.83
Uniqueness: 99.41% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 45.70%
rdkit valid pharmacophore match: 48.32%
rdkit pharmacophore match 2d: 74.80%
rdkit valid pharmacophore match 2d: 76.92%
pgmg pharmacophore match: 48.57%
pgmg valid pharmacophore match: 51.68%
pgmg pharmacophore match percentage: 32.32%
pgmg valid pharmacophore match percentage: 34.91%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.011, 'sampling/AtomTypesTV': 0.101, 'sampling/EdgeTypesTV': 0.041, 'sampling/ChargeW1': 0.009, 'sampling/ValencyW1': 0.211, 'sampling/BondLengthsW1': 0.045, 'sampling/AnglesW1': 14.796}
Sampling metrics done.
Val epoch 9 ends
Train epoch 9 ends
Epoch 9 finished: pos: 0.24 -- X: 0.21 -- charges: 0.04 -- E: 0.25 -- y: -1.00 -- 733.5s 
Starting epoch 10
Train epoch 10 ends
Epoch 10 finished: pos: 0.24 -- X: 0.20 -- charges: 0.04 -- E: 0.25 -- y: -1.00 -- 162.6s 
Starting epoch 11
Train epoch 11 ends
Epoch 11 finished: pos: 0.24 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 161.9s 
Starting epoch 12
Train epoch 12 ends
Epoch 12 finished: pos: 0.23 -- X: 0.20 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 162.0s 
Starting epoch 13
Train epoch 13 ends
Epoch 13 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 162.7s 
Starting epoch 14
Train epoch 14 ends
Epoch 14 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 166.0s 
Starting epoch 15
Train epoch 15 ends
Epoch 15 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 163.5s 
Starting epoch 16
Train epoch 16 ends
Epoch 16 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 161.6s 
Starting epoch 17
Train epoch 17 ends
Epoch 17 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 161.9s 
Starting epoch 18
Train epoch 18 ends
Epoch 18 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 162.0s 
Starting epoch 19
Epoch 19: val/epoch_NLL: 10664571.00 -- val/pos_mse: 10664239.00 -- val/X_kl: 2440.52 -- val/E_kl: 3313.84 -- val/charges_kl: 751.68 
Val loss: 10664571.0000 	 Best val loss:  10664571.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch19/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 545.10 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 442, Kekulize 4, other 2,  -- No error 576
Validity over 1024 molecules: 56.25%
Number of connected components of 1024 molecules: mean:1.15 max:4.00
Connected components of 1024 molecules: 87.21
Uniqueness: 100.00% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 46.68%
rdkit valid pharmacophore match: 51.91%
rdkit pharmacophore match 2d: 73.14%
rdkit valid pharmacophore match 2d: 75.17%
pgmg pharmacophore match: 51.66%
pgmg valid pharmacophore match: 56.51%
pgmg pharmacophore match percentage: 35.55%
pgmg valid pharmacophore match percentage: 40.28%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.006, 'sampling/AtomTypesTV': 0.175, 'sampling/EdgeTypesTV': 0.053, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.211, 'sampling/BondLengthsW1': 0.041, 'sampling/AnglesW1': 10.071}
Sampling metrics done.
Val epoch 19 ends
Train epoch 19 ends
Epoch 19 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 744.3s 
Starting epoch 20
Train epoch 20 ends
Epoch 20 finished: pos: 0.23 -- X: 0.19 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.4s 
Starting epoch 21
Train epoch 21 ends
Epoch 21 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 161.1s 
Starting epoch 22
Train epoch 22 ends
Epoch 22 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.2s 
Starting epoch 23
Train epoch 23 ends
Epoch 23 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 163.0s 
Starting epoch 24
Train epoch 24 ends
Epoch 24 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 164.9s 
Starting epoch 25
Train epoch 25 ends
Epoch 25 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.9s 
Starting epoch 26
Train epoch 26 ends
Epoch 26 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.5s 
Starting epoch 27
Train epoch 27 ends
Epoch 27 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 161.1s 
Starting epoch 28
Train epoch 28 ends
Epoch 28 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.2s 
Starting epoch 29
Epoch 29: val/epoch_NLL: 4336356.50 -- val/pos_mse: 4336063.50 -- val/X_kl: 2198.39 -- val/E_kl: 3053.96 -- val/charges_kl: 491.64 
Val loss: 4336356.5000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch29/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 542.71 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 373, Kekulize 1, other 2,  -- No error 648
Validity over 1024 molecules: 63.28%
Number of connected components of 1024 molecules: mean:1.07 max:3.00
Connected components of 1024 molecules: 93.65
Uniqueness: 99.69% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 48.93%
rdkit valid pharmacophore match: 52.31%
rdkit pharmacophore match 2d: 75.39%
rdkit valid pharmacophore match 2d: 77.93%
pgmg pharmacophore match: 54.77%
pgmg valid pharmacophore match: 57.38%
pgmg pharmacophore match percentage: 38.87%
pgmg valid pharmacophore match percentage: 42.13%
Sparsity level on local rank 0: 72 %
Sampling metrics {'sampling/NumNodesW1': 0.019, 'sampling/AtomTypesTV': 0.169, 'sampling/EdgeTypesTV': 0.038, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.193, 'sampling/BondLengthsW1': 0.026, 'sampling/AnglesW1': 7.893}
Sampling metrics done.
Val epoch 29 ends
Train epoch 29 ends
Epoch 29 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 736.4s 
Starting epoch 30
Train epoch 30 ends
Epoch 30 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 162.6s 
Starting epoch 31
Train epoch 31 ends
Epoch 31 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.23 -- y: -1.00 -- 162.4s 
Starting epoch 32
Train epoch 32 ends
Epoch 32 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.23 -- y: -1.00 -- 162.5s 
Starting epoch 33
Train epoch 33 ends
Epoch 33 finished: pos: 0.23 -- X: 0.18 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 163.2s 
Starting epoch 34
Train epoch 34 ends
Epoch 34 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.23 -- y: -1.00 -- 165.0s 
Starting epoch 35
Train epoch 35 ends
Epoch 35 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.23 -- y: -1.00 -- 165.6s 
Starting epoch 36
Train epoch 36 ends
Epoch 36 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.23 -- y: -1.00 -- 161.2s 
Starting epoch 37
Train epoch 37 ends
Epoch 37 finished: pos: 0.22 -- X: 0.18 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 161.0s 
Starting epoch 38
Train epoch 38 ends
Epoch 38 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 161.3s 
Starting epoch 39
Epoch 39: val/epoch_NLL: 14153293.00 -- val/pos_mse: 14153009.00 -- val/X_kl: 2145.32 -- val/E_kl: 3031.15 -- val/charges_kl: 488.51 
Val loss: 14153293.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch39/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 546.96 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 341, Kekulize 0, other 1,  -- No error 682
Validity over 1024 molecules: 66.60%
Number of connected components of 1024 molecules: mean:1.05 max:3.00
Connected components of 1024 molecules: 95.41
Uniqueness: 99.41% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 52.05%
rdkit valid pharmacophore match: 56.45%
rdkit pharmacophore match 2d: 76.76%
rdkit valid pharmacophore match 2d: 78.15%
pgmg pharmacophore match: 57.29%
pgmg valid pharmacophore match: 60.24%
pgmg pharmacophore match percentage: 42.48%
pgmg valid pharmacophore match percentage: 46.19%
Sparsity level on local rank 0: 72 %
Sampling metrics {'sampling/NumNodesW1': 0.015, 'sampling/AtomTypesTV': 0.16, 'sampling/EdgeTypesTV': 0.028, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.208, 'sampling/BondLengthsW1': 0.03, 'sampling/AnglesW1': 8.241}
Sampling metrics done.
Val epoch 39 ends
Train epoch 39 ends
Epoch 39 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 741.3s 
Starting epoch 40
Train epoch 40 ends
Epoch 40 finished: pos: 0.22 -- X: 0.18 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.4s 
Starting epoch 41
Train epoch 41 ends
Epoch 41 finished: pos: 0.23 -- X: 0.18 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.0s 
Starting epoch 42
Train epoch 42 ends
Epoch 42 finished: pos: 0.23 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 160.8s 
Starting epoch 43
Train epoch 43 ends
Epoch 43 finished: pos: 0.23 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.8s 
Starting epoch 44
Train epoch 44 ends
Epoch 44 finished: pos: 0.23 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 164.9s 
Starting epoch 45
Train epoch 45 ends
Epoch 45 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 164.2s 
Starting epoch 46
Train epoch 46 ends
Epoch 46 finished: pos: 0.23 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.2s 
Starting epoch 47
Train epoch 47 ends
Epoch 47 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.2s 
Starting epoch 48
Train epoch 48 ends
Epoch 48 finished: pos: 0.23 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.6s 
Starting epoch 49
Epoch 49: val/epoch_NLL: 7273040.50 -- val/pos_mse: 7272762.00 -- val/X_kl: 2082.81 -- val/E_kl: 2856.96 -- val/charges_kl: 559.46 
Val loss: 7273040.5000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch49/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 558.00 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 217, Kekulize 1, other 0,  -- No error 806
Validity over 1024 molecules: 78.71%
Number of connected components of 1024 molecules: mean:1.05 max:3.00
Connected components of 1024 molecules: 95.12
Uniqueness: 99.13% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.03%
rdkit valid pharmacophore match: 56.45%
rdkit pharmacophore match 2d: 76.56%
rdkit valid pharmacophore match 2d: 78.04%
pgmg pharmacophore match: 57.08%
pgmg valid pharmacophore match: 58.50%
pgmg pharmacophore match percentage: 40.43%
pgmg valid pharmacophore match percentage: 43.05%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.01, 'sampling/AtomTypesTV': 0.208, 'sampling/EdgeTypesTV': 0.052, 'sampling/ChargeW1': 0.017, 'sampling/ValencyW1': 0.138, 'sampling/BondLengthsW1': 0.023, 'sampling/AnglesW1': 6.012}
Sampling metrics done.
Val epoch 49 ends
Train epoch 49 ends
Epoch 49 finished: pos: 0.23 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 751.7s 
Starting epoch 50
Train epoch 50 ends
Epoch 50 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.5s 
Starting epoch 51
Train epoch 51 ends
Epoch 51 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.2s 
Starting epoch 52
Train epoch 52 ends
Epoch 52 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.1s 
Starting epoch 53
Train epoch 53 ends
Epoch 53 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.7s 
Starting epoch 54
Train epoch 54 ends
Epoch 54 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 165.9s 
Starting epoch 55
Train epoch 55 ends
Epoch 55 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.9s 
Starting epoch 56
Train epoch 56 ends
Epoch 56 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.4s 
Starting epoch 57
Train epoch 57 ends
Epoch 57 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 161.9s 
Starting epoch 58
Train epoch 58 ends
Epoch 58 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.9s 
Starting epoch 59
Epoch 59: val/epoch_NLL: 8857704.00 -- val/pos_mse: 8857433.00 -- val/X_kl: 1966.76 -- val/E_kl: 2865.14 -- val/charges_kl: 475.21 
Val loss: 8857704.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch59/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 548.80 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 205, Kekulize 0, other 0,  -- No error 819
Validity over 1024 molecules: 79.98%
Number of connected components of 1024 molecules: mean:1.06 max:3.00
Connected components of 1024 molecules: 94.14
Uniqueness: 99.15% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 55.08%
rdkit valid pharmacophore match: 59.10%
rdkit pharmacophore match 2d: 79.59%
rdkit valid pharmacophore match 2d: 80.59%
pgmg pharmacophore match: 58.85%
pgmg valid pharmacophore match: 61.38%
pgmg pharmacophore match percentage: 42.77%
pgmg valid pharmacophore match percentage: 46.03%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.009, 'sampling/AtomTypesTV': 0.17, 'sampling/EdgeTypesTV': 0.054, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.135, 'sampling/BondLengthsW1': 0.02, 'sampling/AnglesW1': 7.394}
Sampling metrics done.
Val epoch 59 ends
Train epoch 59 ends
Epoch 59 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 743.0s 
Starting epoch 60
Train epoch 60 ends
Epoch 60 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.9s 
Starting epoch 61
Train epoch 61 ends
Epoch 61 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.2s 
Starting epoch 62
Train epoch 62 ends
Epoch 62 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 165.1s 
Starting epoch 63
Train epoch 63 ends
Epoch 63 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.3s 
Starting epoch 64
Train epoch 64 ends
Epoch 64 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 165.3s 
Starting epoch 65
Train epoch 65 ends
Epoch 65 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.0s 
Starting epoch 66
Train epoch 66 ends
Epoch 66 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.3s 
Starting epoch 67
Train epoch 67 ends
Epoch 67 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.1s 
Starting epoch 68
Train epoch 68 ends
Epoch 68 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.2s 
Starting epoch 69
Epoch 69: val/epoch_NLL: 13538112.00 -- val/pos_mse: 13537853.00 -- val/X_kl: 1861.47 -- val/E_kl: 2799.85 -- val/charges_kl: 398.68 
Val loss: 13538112.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch69/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 548.10 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 187, Kekulize 0, other 0,  -- No error 837
Validity over 1024 molecules: 81.74%
Number of connected components of 1024 molecules: mean:1.03 max:3.00
Connected components of 1024 molecules: 97.27
Uniqueness: 99.52% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 56.05%
rdkit valid pharmacophore match: 57.23%
rdkit pharmacophore match 2d: 78.22%
rdkit valid pharmacophore match 2d: 77.90%
pgmg pharmacophore match: 58.50%
pgmg valid pharmacophore match: 59.62%
pgmg pharmacophore match percentage: 41.70%
pgmg valid pharmacophore match percentage: 43.13%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.035, 'sampling/AtomTypesTV': 0.138, 'sampling/EdgeTypesTV': 0.039, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.162, 'sampling/BondLengthsW1': 0.016, 'sampling/AnglesW1': 5.497}
Sampling metrics done.
Val epoch 69 ends
Train epoch 69 ends
Epoch 69 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 742.8s 
Starting epoch 70
Train epoch 70 ends
Epoch 70 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.7s 
Starting epoch 71
Train epoch 71 ends
Epoch 71 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.2s 
Starting epoch 72
Train epoch 72 ends
Epoch 72 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.0s 
Starting epoch 73
Train epoch 73 ends
Epoch 73 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.2s 
Starting epoch 74
Train epoch 74 ends
Epoch 74 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 164.8s 
Starting epoch 75
Train epoch 75 ends
Epoch 75 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 164.2s 
Starting epoch 76
Train epoch 76 ends
Epoch 76 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.4s 
Starting epoch 77
Train epoch 77 ends
Epoch 77 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 165.2s 
Starting epoch 78
Train epoch 78 ends
Epoch 78 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.5s 
Starting epoch 79
Epoch 79: val/epoch_NLL: 5776977.00 -- val/pos_mse: 5776715.50 -- val/X_kl: 1939.92 -- val/E_kl: 2725.74 -- val/charges_kl: 479.83 
Val loss: 5776977.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch79/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 542.35 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 162, Kekulize 0, other 0,  -- No error 862
Validity over 1024 molecules: 84.18%
Number of connected components of 1024 molecules: mean:1.03 max:3.00
Connected components of 1024 molecules: 97.36
Uniqueness: 98.84% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 50.88%
rdkit valid pharmacophore match: 53.48%
rdkit pharmacophore match 2d: 76.46%
rdkit valid pharmacophore match 2d: 76.68%
pgmg pharmacophore match: 57.24%
pgmg valid pharmacophore match: 58.57%
pgmg pharmacophore match percentage: 42.09%
pgmg valid pharmacophore match percentage: 43.74%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.013, 'sampling/AtomTypesTV': 0.173, 'sampling/EdgeTypesTV': 0.06, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.164, 'sampling/BondLengthsW1': 0.014, 'sampling/AnglesW1': 5.675}
Sampling metrics done.
Val epoch 79 ends
Train epoch 79 ends
Epoch 79 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 739.5s 
Starting epoch 80
Train epoch 80 ends
Epoch 80 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.7s 
Starting epoch 81
Train epoch 81 ends
Epoch 81 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.4s 
Starting epoch 82
Train epoch 82 ends
Epoch 82 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 162.0s 
Starting epoch 83
Train epoch 83 ends
Epoch 83 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.2s 
Starting epoch 84
Train epoch 84 ends
Epoch 84 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 164.8s 
Starting epoch 85
Train epoch 85 ends
Epoch 85 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 163.0s 
Starting epoch 86
Train epoch 86 ends
Epoch 86 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 87
Train epoch 87 ends
Epoch 87 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.9s 
Starting epoch 88
Train epoch 88 ends
Epoch 88 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.6s 
Starting epoch 89
Epoch 89: val/epoch_NLL: 6072567.00 -- val/pos_mse: 6072303.00 -- val/X_kl: 1953.99 -- val/E_kl: 2763.90 -- val/charges_kl: 454.10 
Val loss: 6072567.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch89/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 553.66 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 158, Kekulize 0, other 0,  -- No error 866
Validity over 1024 molecules: 84.57%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 97.95
Uniqueness: 97.81% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 54.39%
rdkit valid pharmacophore match: 56.12%
rdkit pharmacophore match 2d: 77.83%
rdkit valid pharmacophore match 2d: 78.41%
pgmg pharmacophore match: 57.08%
pgmg valid pharmacophore match: 59.70%
pgmg pharmacophore match percentage: 41.11%
pgmg valid pharmacophore match percentage: 43.53%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.004, 'sampling/AtomTypesTV': 0.204, 'sampling/EdgeTypesTV': 0.045, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.205, 'sampling/BondLengthsW1': 0.018, 'sampling/AnglesW1': 4.898}
Sampling metrics done.
Val epoch 89 ends
Train epoch 89 ends
Epoch 89 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 747.9s 
Starting epoch 90
Train epoch 90 ends
Epoch 90 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.9s 
Starting epoch 91
Train epoch 91 ends
Epoch 91 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 92
Train epoch 92 ends
Epoch 92 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 93
Train epoch 93 ends
Epoch 93 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.2s 
Starting epoch 94
Train epoch 94 ends
Epoch 94 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.9s 
Starting epoch 95
Train epoch 95 ends
Epoch 95 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.6s 
Starting epoch 96
Train epoch 96 ends
Epoch 96 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 97
Train epoch 97 ends
Epoch 97 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 98
Train epoch 98 ends
Epoch 98 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 99
Epoch 99: val/epoch_NLL: 13950409.00 -- val/pos_mse: 13950158.00 -- val/X_kl: 1818.08 -- val/E_kl: 2622.77 -- val/charges_kl: 445.82 
Val loss: 13950409.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch99/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 544.80 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 158, Kekulize 1, other 0,  -- No error 865
Validity over 1024 molecules: 84.47%
Number of connected components of 1024 molecules: mean:1.04 max:3.00
Connected components of 1024 molecules: 96.00
Uniqueness: 98.27% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.12%
rdkit valid pharmacophore match: 56.88%
rdkit pharmacophore match 2d: 78.22%
rdkit valid pharmacophore match 2d: 79.65%
pgmg pharmacophore match: 57.67%
pgmg valid pharmacophore match: 60.62%
pgmg pharmacophore match percentage: 42.19%
pgmg valid pharmacophore match percentage: 45.78%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.029, 'sampling/AtomTypesTV': 0.197, 'sampling/EdgeTypesTV': 0.073, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.149, 'sampling/BondLengthsW1': 0.016, 'sampling/AnglesW1': 7.041}
Sampling metrics done.
Val epoch 99 ends
Train epoch 99 ends
Epoch 99 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.22 -- y: -1.00 -- 735.8s 
Starting epoch 100
Train epoch 100 ends
Epoch 100 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 101
Train epoch 101 ends
Epoch 101 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 102
Train epoch 102 ends
Epoch 102 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 103
Train epoch 103 ends
Epoch 103 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.2s 
Starting epoch 104
Train epoch 104 ends
Epoch 104 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.9s 
Starting epoch 105
Train epoch 105 ends
Epoch 105 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 106
Train epoch 106 ends
Epoch 106 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.2s 
Starting epoch 107
Train epoch 107 ends
Epoch 107 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.1s 
Starting epoch 108
Train epoch 108 ends
Epoch 108 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 109
Epoch 109: val/epoch_NLL: 7389482.50 -- val/pos_mse: 7389229.50 -- val/X_kl: 1842.40 -- val/E_kl: 2662.44 -- val/charges_kl: 476.80 
Val loss: 7389482.5000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch109/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 547.24 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 135, Kekulize 0, other 1,  -- No error 888
Validity over 1024 molecules: 86.72%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 97.75
Uniqueness: 99.10% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 55.86%
rdkit valid pharmacophore match: 59.35%
rdkit pharmacophore match 2d: 77.05%
rdkit valid pharmacophore match 2d: 78.60%
pgmg pharmacophore match: 58.81%
pgmg valid pharmacophore match: 61.47%
pgmg pharmacophore match percentage: 44.14%
pgmg valid pharmacophore match percentage: 47.41%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.014, 'sampling/AtomTypesTV': 0.175, 'sampling/EdgeTypesTV': 0.061, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.141, 'sampling/BondLengthsW1': 0.015, 'sampling/AnglesW1': 6.408}
Sampling metrics done.
Val epoch 109 ends
Train epoch 109 ends
Epoch 109 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 744.3s 
Starting epoch 110
Train epoch 110 ends
Epoch 110 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 111
Train epoch 111 ends
Epoch 111 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.0s 
Starting epoch 112
Train epoch 112 ends
Epoch 112 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 113
Train epoch 113 ends
Epoch 113 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 114
Train epoch 114 ends
Epoch 114 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.8s 
Starting epoch 115
Train epoch 115 ends
Epoch 115 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.6s 
Starting epoch 116
Train epoch 116 ends
Epoch 116 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 117
Train epoch 117 ends
Epoch 117 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 118
Train epoch 118 ends
Epoch 118 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 119
Epoch 119: val/epoch_NLL: 4867509.00 -- val/pos_mse: 4867259.00 -- val/X_kl: 1836.69 -- val/E_kl: 2636.97 -- val/charges_kl: 447.67 
Val loss: 4867509.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch119/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 543.54 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 183, Kekulize 1, other 0,  -- No error 840
Validity over 1024 molecules: 82.03%
Number of connected components of 1024 molecules: mean:1.06 max:3.00
Connected components of 1024 molecules: 94.24
Uniqueness: 98.21% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 54.69%
rdkit valid pharmacophore match: 56.79%
rdkit pharmacophore match 2d: 77.25%
rdkit valid pharmacophore match 2d: 77.98%
pgmg pharmacophore match: 57.78%
pgmg valid pharmacophore match: 59.21%
pgmg pharmacophore match percentage: 42.87%
pgmg valid pharmacophore match percentage: 44.40%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.027, 'sampling/AtomTypesTV': 0.216, 'sampling/EdgeTypesTV': 0.058, 'sampling/ChargeW1': 0.014, 'sampling/ValencyW1': 0.173, 'sampling/BondLengthsW1': 0.019, 'sampling/AnglesW1': 5.073}
Sampling metrics done.
Val epoch 119 ends
Train epoch 119 ends
Epoch 119 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 736.3s 
Starting epoch 120
Train epoch 120 ends
Epoch 120 finished: pos: 0.22 -- X: 0.17 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 121
Train epoch 121 ends
Epoch 121 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.1s 
Starting epoch 122
Train epoch 122 ends
Epoch 122 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.0s 
Starting epoch 123
Train epoch 123 ends
Epoch 123 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.3s 
Starting epoch 124
Train epoch 124 ends
Epoch 124 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.8s 
Starting epoch 125
Train epoch 125 ends
Epoch 125 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.9s 
Starting epoch 126
Train epoch 126 ends
Epoch 126 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 127
Train epoch 127 ends
Epoch 127 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 128
Train epoch 128 ends
Epoch 128 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 129
Epoch 129: val/epoch_NLL: 7783183.00 -- val/pos_mse: 7782933.00 -- val/X_kl: 1870.91 -- val/E_kl: 2616.90 -- val/charges_kl: 424.46 
Val loss: 7783183.0000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch129/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 545.16 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 176, Kekulize 0, other 0,  -- No error 848
Validity over 1024 molecules: 82.81%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 98.24
Uniqueness: 98.35% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.03%
rdkit valid pharmacophore match: 56.49%
rdkit pharmacophore match 2d: 76.95%
rdkit valid pharmacophore match 2d: 77.83%
pgmg pharmacophore match: 57.62%
pgmg valid pharmacophore match: 59.51%
pgmg pharmacophore match percentage: 42.68%
pgmg valid pharmacophore match percentage: 45.17%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.033, 'sampling/AtomTypesTV': 0.209, 'sampling/EdgeTypesTV': 0.051, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.214, 'sampling/BondLengthsW1': 0.02, 'sampling/AnglesW1': 5.169}
Sampling metrics done.
Val epoch 129 ends
Train epoch 129 ends
Epoch 129 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 737.6s 
Starting epoch 130
Train epoch 130 ends
Epoch 130 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 131
Train epoch 131 ends
Epoch 131 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 132
Train epoch 132 ends
Epoch 132 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 133
Train epoch 133 ends
Epoch 133 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.8s 
Starting epoch 134
Train epoch 134 ends
Epoch 134 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.9s 
Starting epoch 135
Train epoch 135 ends
Epoch 135 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.3s 
Starting epoch 136
Train epoch 136 ends
Epoch 136 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.0s 
Starting epoch 137
Train epoch 137 ends
Epoch 137 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.1s 
Starting epoch 138
Train epoch 138 ends
Epoch 138 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 139
Epoch 139: val/epoch_NLL: 7138829.50 -- val/pos_mse: 7138577.00 -- val/X_kl: 1849.82 -- val/E_kl: 2638.68 -- val/charges_kl: 478.59 
Val loss: 7138829.5000 	 Best val loss:  4336356.5000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch139/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 551.12 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 180, Kekulize 0, other 0,  -- No error 844
Validity over 1024 molecules: 82.42%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 98.73
Uniqueness: 97.87% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.91%
rdkit valid pharmacophore match: 56.40%
rdkit pharmacophore match 2d: 74.51%
rdkit valid pharmacophore match 2d: 75.12%
pgmg pharmacophore match: 56.41%
pgmg valid pharmacophore match: 59.20%
pgmg pharmacophore match percentage: 40.43%
pgmg valid pharmacophore match percentage: 42.77%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.021, 'sampling/AtomTypesTV': 0.219, 'sampling/EdgeTypesTV': 0.07, 'sampling/ChargeW1': 0.014, 'sampling/ValencyW1': 0.185, 'sampling/BondLengthsW1': 0.016, 'sampling/AnglesW1': 6.363}
Sampling metrics done.
Val epoch 139 ends
Train epoch 139 ends
Epoch 139 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 743.2s 
Starting epoch 140
Train epoch 140 ends
Epoch 140 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 141
Train epoch 141 ends
Epoch 141 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.2s 
Starting epoch 142
Train epoch 142 ends
Epoch 142 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 143
Train epoch 143 ends
Epoch 143 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 144
Train epoch 144 ends
Epoch 144 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.6s 
Starting epoch 145
Train epoch 145 ends
Epoch 145 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.4s 
Starting epoch 146
Train epoch 146 ends
Epoch 146 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 147
Train epoch 147 ends
Epoch 147 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 148
Train epoch 148 ends
Epoch 148 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 149
Epoch 149: val/epoch_NLL: 2126143.25 -- val/pos_mse: 2125897.25 -- val/X_kl: 1848.87 -- val/E_kl: 2587.33 -- val/charges_kl: 391.29 
Val loss: 2126143.2500 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch149/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 542.05 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 122, Kekulize 0, other 0,  -- No error 902
Validity over 1024 molecules: 88.09%
Number of connected components of 1024 molecules: mean:1.03 max:3.00
Connected components of 1024 molecules: 97.17
Uniqueness: 98.23% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 52.93%
rdkit valid pharmacophore match: 55.10%
rdkit pharmacophore match 2d: 74.12%
rdkit valid pharmacophore match 2d: 74.50%
pgmg pharmacophore match: 58.53%
pgmg valid pharmacophore match: 59.98%
pgmg pharmacophore match percentage: 44.34%
pgmg valid pharmacophore match percentage: 45.79%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.014, 'sampling/AtomTypesTV': 0.204, 'sampling/EdgeTypesTV': 0.078, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.189, 'sampling/BondLengthsW1': 0.017, 'sampling/AnglesW1': 6.918}
Sampling metrics done.
Val epoch 149 ends
Train epoch 149 ends
Epoch 149 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 732.8s 
Starting epoch 150
Train epoch 150 ends
Epoch 150 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 151
Train epoch 151 ends
Epoch 151 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 152
Train epoch 152 ends
Epoch 152 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 153
Train epoch 153 ends
Epoch 153 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.3s 
Starting epoch 154
Train epoch 154 ends
Epoch 154 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 155
Train epoch 155 ends
Epoch 155 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.8s 
Starting epoch 156
Train epoch 156 ends
Epoch 156 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.6s 
Starting epoch 157
Train epoch 157 ends
Epoch 157 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 158
Train epoch 158 ends
Epoch 158 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 159
Epoch 159: val/epoch_NLL: 8531870.00 -- val/pos_mse: 8531623.00 -- val/X_kl: 1848.29 -- val/E_kl: 2593.78 -- val/charges_kl: 409.36 
Val loss: 8531870.0000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch159/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 544.32 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 127, Kekulize 0, other 0,  -- No error 897
Validity over 1024 molecules: 87.60%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 98.34
Uniqueness: 97.55% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 51.46%
rdkit valid pharmacophore match: 53.73%
rdkit pharmacophore match 2d: 76.46%
rdkit valid pharmacophore match 2d: 76.59%
pgmg pharmacophore match: 58.12%
pgmg valid pharmacophore match: 59.77%
pgmg pharmacophore match percentage: 41.99%
pgmg valid pharmacophore match percentage: 43.92%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.011, 'sampling/AtomTypesTV': 0.222, 'sampling/EdgeTypesTV': 0.055, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.194, 'sampling/BondLengthsW1': 0.016, 'sampling/AnglesW1': 4.936}
Sampling metrics done.
Val epoch 159 ends
Train epoch 159 ends
Epoch 159 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 735.7s 
Starting epoch 160
Train epoch 160 ends
Epoch 160 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 161
Train epoch 161 ends
Epoch 161 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 162
Train epoch 162 ends
Epoch 162 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 163
Train epoch 163 ends
Epoch 163 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 164
Train epoch 164 ends
Epoch 164 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 165
Train epoch 165 ends
Epoch 165 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.7s 
Starting epoch 166
Train epoch 166 ends
Epoch 166 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.5s 
Starting epoch 167
Train epoch 167 ends
Epoch 167 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 168
Train epoch 168 ends
Epoch 168 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 169
Epoch 169: val/epoch_NLL: 6685398.50 -- val/pos_mse: 6685161.00 -- val/X_kl: 1744.16 -- val/E_kl: 2529.22 -- val/charges_kl: 403.01 
Val loss: 6685398.5000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch169/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 550.10 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 116, Kekulize 0, other 0,  -- No error 908
Validity over 1024 molecules: 88.67%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 97.75
Uniqueness: 97.03% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 56.35%
rdkit valid pharmacophore match: 58.37%
rdkit pharmacophore match 2d: 78.32%
rdkit valid pharmacophore match 2d: 78.41%
pgmg pharmacophore match: 60.45%
pgmg valid pharmacophore match: 62.76%
pgmg pharmacophore match percentage: 46.39%
pgmg valid pharmacophore match percentage: 48.57%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.025, 'sampling/AtomTypesTV': 0.185, 'sampling/EdgeTypesTV': 0.047, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.171, 'sampling/BondLengthsW1': 0.013, 'sampling/AnglesW1': 4.844}
Sampling metrics done.
Val epoch 169 ends
Train epoch 169 ends
Epoch 169 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 741.4s 
Starting epoch 170
Train epoch 170 ends
Epoch 170 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 171
Train epoch 171 ends
Epoch 171 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.5s 
Starting epoch 172
Train epoch 172 ends
Epoch 172 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 173
Train epoch 173 ends
Epoch 173 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 174
Train epoch 174 ends
Epoch 174 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.0s 
Starting epoch 175
Train epoch 175 ends
Epoch 175 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.1s 
Starting epoch 176
Train epoch 176 ends
Epoch 176 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.9s 
Starting epoch 177
Train epoch 177 ends
Epoch 177 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 178
Train epoch 178 ends
Epoch 178 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 179
Epoch 179: val/epoch_NLL: 10037461.00 -- val/pos_mse: 10037217.00 -- val/X_kl: 1779.13 -- val/E_kl: 2599.91 -- val/charges_kl: 410.14 
Val loss: 10037461.0000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch179/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 546.46 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 112, Kekulize 0, other 0,  -- No error 912
Validity over 1024 molecules: 89.06%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 98.93
Uniqueness: 97.59% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.12%
rdkit valid pharmacophore match: 56.69%
rdkit pharmacophore match 2d: 77.83%
rdkit valid pharmacophore match 2d: 78.07%
pgmg pharmacophore match: 56.82%
pgmg valid pharmacophore match: 58.41%
pgmg pharmacophore match percentage: 40.82%
pgmg valid pharmacophore match percentage: 42.54%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.016, 'sampling/AtomTypesTV': 0.179, 'sampling/EdgeTypesTV': 0.063, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.19, 'sampling/BondLengthsW1': 0.015, 'sampling/AnglesW1': 6.688}
Sampling metrics done.
Val epoch 179 ends
Train epoch 179 ends
Epoch 179 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 736.7s 
Starting epoch 180
Train epoch 180 ends
Epoch 180 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 181
Train epoch 181 ends
Epoch 181 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.6s 
Starting epoch 182
Train epoch 182 ends
Epoch 182 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 183
Train epoch 183 ends
Epoch 183 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 184
Train epoch 184 ends
Epoch 184 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 166.8s 
Starting epoch 185
Train epoch 185 ends
Epoch 185 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.4s 
Starting epoch 186
Train epoch 186 ends
Epoch 186 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 187
Train epoch 187 ends
Epoch 187 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 188
Train epoch 188 ends
Epoch 188 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 189
Epoch 189: val/epoch_NLL: 8538744.00 -- val/pos_mse: 8538503.00 -- val/X_kl: 1766.94 -- val/E_kl: 2526.94 -- val/charges_kl: 413.80 
Val loss: 8538744.0000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch189/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 553.94 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 110, Kekulize 0, other 0,  -- No error 914
Validity over 1024 molecules: 89.26%
Number of connected components of 1024 molecules: mean:1.01 max:3.00
Connected components of 1024 molecules: 98.63
Uniqueness: 97.16% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 54.69%
rdkit valid pharmacophore match: 56.46%
rdkit pharmacophore match 2d: 77.05%
rdkit valid pharmacophore match 2d: 76.59%
pgmg pharmacophore match: 59.03%
pgmg valid pharmacophore match: 60.90%
pgmg pharmacophore match percentage: 41.89%
pgmg valid pharmacophore match percentage: 44.31%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.012, 'sampling/AtomTypesTV': 0.182, 'sampling/EdgeTypesTV': 0.057, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.168, 'sampling/BondLengthsW1': 0.025, 'sampling/AnglesW1': 5.482}
Sampling metrics done.
Val epoch 189 ends
Train epoch 189 ends
Epoch 189 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 747.4s 
Starting epoch 190
Train epoch 190 ends
Epoch 190 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 191
Train epoch 191 ends
Epoch 191 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 192
Train epoch 192 ends
Epoch 192 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 193
Train epoch 193 ends
Epoch 193 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.7s 
Starting epoch 194
Train epoch 194 ends
Epoch 194 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.0s 
Starting epoch 195
Train epoch 195 ends
Epoch 195 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 166.3s 
Starting epoch 196
Train epoch 196 ends
Epoch 196 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 197
Train epoch 197 ends
Epoch 197 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.3s 
Starting epoch 198
Train epoch 198 ends
Epoch 198 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 199
Epoch 199: val/epoch_NLL: 18652990.00 -- val/pos_mse: 18652752.00 -- val/X_kl: 1788.64 -- val/E_kl: 2498.99 -- val/charges_kl: 434.69 
Val loss: 18652990.0000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch199/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 554.47 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 117, Kekulize 1, other 0,  -- No error 906
Validity over 1024 molecules: 88.48%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 97.56
Uniqueness: 96.91% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.12%
rdkit valid pharmacophore match: 55.08%
rdkit pharmacophore match 2d: 76.95%
rdkit valid pharmacophore match 2d: 76.38%
pgmg pharmacophore match: 58.81%
pgmg valid pharmacophore match: 59.73%
pgmg pharmacophore match percentage: 42.77%
pgmg valid pharmacophore match percentage: 44.04%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.023, 'sampling/AtomTypesTV': 0.188, 'sampling/EdgeTypesTV': 0.071, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.163, 'sampling/BondLengthsW1': 0.017, 'sampling/AnglesW1': 7.683}
Sampling metrics done.
Val epoch 199 ends
Train epoch 199 ends
Epoch 199 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 747.1s 
Starting epoch 200
Train epoch 200 ends
Epoch 200 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 201
Train epoch 201 ends
Epoch 201 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.2s 
Starting epoch 202
Train epoch 202 ends
Epoch 202 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 203
Train epoch 203 ends
Epoch 203 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.8s 
Starting epoch 204
Train epoch 204 ends
Epoch 204 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.9s 
Starting epoch 205
Train epoch 205 ends
Epoch 205 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.1s 
Starting epoch 206
Train epoch 206 ends
Epoch 206 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 207
Train epoch 207 ends
Epoch 207 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.6s 
Starting epoch 208
Train epoch 208 ends
Epoch 208 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.7s 
Starting epoch 209
Epoch 209: val/epoch_NLL: 6763618.50 -- val/pos_mse: 6763379.00 -- val/X_kl: 1784.14 -- val/E_kl: 2479.95 -- val/charges_kl: 412.90 
Val loss: 6763618.5000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch209/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 549.91 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 92, Kekulize 0, other 0,  -- No error 932
Validity over 1024 molecules: 91.02%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 97.85
Uniqueness: 97.42% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 54.69%
rdkit valid pharmacophore match: 56.33%
rdkit pharmacophore match 2d: 78.91%
rdkit valid pharmacophore match 2d: 78.76%
pgmg pharmacophore match: 59.52%
pgmg valid pharmacophore match: 60.35%
pgmg pharmacophore match percentage: 43.85%
pgmg valid pharmacophore match percentage: 44.42%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.013, 'sampling/AtomTypesTV': 0.204, 'sampling/EdgeTypesTV': 0.054, 'sampling/ChargeW1': 0.014, 'sampling/ValencyW1': 0.159, 'sampling/BondLengthsW1': 0.025, 'sampling/AnglesW1': 5.448}
Sampling metrics done.
Val epoch 209 ends
Train epoch 209 ends
Epoch 209 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 742.9s 
Starting epoch 210
Train epoch 210 ends
Epoch 210 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 211
Train epoch 211 ends
Epoch 211 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 212
Train epoch 212 ends
Epoch 212 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 213
Train epoch 213 ends
Epoch 213 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.4s 
Starting epoch 214
Train epoch 214 ends
Epoch 214 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.8s 
Starting epoch 215
Train epoch 215 ends
Epoch 215 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.8s 
Starting epoch 216
Train epoch 216 ends
Epoch 216 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 217
Train epoch 217 ends
Epoch 217 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.0s 
Starting epoch 218
Train epoch 218 ends
Epoch 218 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.1s 
Starting epoch 219
Epoch 219: val/epoch_NLL: 10990859.00 -- val/pos_mse: 10990622.00 -- val/X_kl: 1729.01 -- val/E_kl: 2494.41 -- val/charges_kl: 426.66 
Val loss: 10990859.0000 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch219/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 551.99 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 96, Kekulize 0, other 0,  -- No error 928
Validity over 1024 molecules: 90.62%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 98.24
Uniqueness: 95.37% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 52.64%
rdkit valid pharmacophore match: 55.93%
rdkit pharmacophore match 2d: 75.78%
rdkit valid pharmacophore match 2d: 76.62%
pgmg pharmacophore match: 57.05%
pgmg valid pharmacophore match: 59.48%
pgmg pharmacophore match percentage: 39.36%
pgmg valid pharmacophore match percentage: 42.46%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.012, 'sampling/AtomTypesTV': 0.209, 'sampling/EdgeTypesTV': 0.064, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.171, 'sampling/BondLengthsW1': 0.019, 'sampling/AnglesW1': 6.873}
Sampling metrics done.
Val epoch 219 ends
Train epoch 219 ends
Epoch 219 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 745.9s 
Starting epoch 220
Train epoch 220 ends
Epoch 220 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.5s 
Starting epoch 221
Train epoch 221 ends
Epoch 221 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.3s 
Starting epoch 222
Train epoch 222 ends
Epoch 222 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 223
Train epoch 223 ends
Epoch 223 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.7s 
Starting epoch 224
Train epoch 224 ends
Epoch 224 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.7s 
Starting epoch 225
Train epoch 225 ends
Epoch 225 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.0s 
Starting epoch 226
Train epoch 226 ends
Epoch 226 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 227
Train epoch 227 ends
Epoch 227 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 228
Train epoch 228 ends
Epoch 228 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 229
Epoch 229: val/epoch_NLL: 2685916.25 -- val/pos_mse: 2685674.00 -- val/X_kl: 1786.18 -- val/E_kl: 2560.72 -- val/charges_kl: 420.78 
Val loss: 2685916.2500 	 Best val loss:  2126143.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch229/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 550.62 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 102, Kekulize 0, other 0,  -- No error 922
Validity over 1024 molecules: 90.04%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 98.34
Uniqueness: 96.75% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 52.15%
rdkit valid pharmacophore match: 53.15%
rdkit pharmacophore match 2d: 75.88%
rdkit valid pharmacophore match 2d: 76.03%
pgmg pharmacophore match: 57.54%
pgmg valid pharmacophore match: 57.94%
pgmg pharmacophore match percentage: 43.55%
pgmg valid pharmacophore match percentage: 44.14%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.011, 'sampling/AtomTypesTV': 0.231, 'sampling/EdgeTypesTV': 0.07, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.192, 'sampling/BondLengthsW1': 0.016, 'sampling/AnglesW1': 6.242}
Sampling metrics done.
Val epoch 229 ends
Train epoch 229 ends
Epoch 229 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 744.0s 
Starting epoch 230
Train epoch 230 ends
Epoch 230 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.7s 
Starting epoch 231
Train epoch 231 ends
Epoch 231 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 232
Train epoch 232 ends
Epoch 232 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 233
Train epoch 233 ends
Epoch 233 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.7s 
Starting epoch 234
Train epoch 234 ends
Epoch 234 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 167.6s 
Starting epoch 235
Train epoch 235 ends
Epoch 235 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.2s 
Starting epoch 236
Train epoch 236 ends
Epoch 236 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 237
Train epoch 237 ends
Epoch 237 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.0s 
Starting epoch 238
Train epoch 238 ends
Epoch 238 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.0s 
Starting epoch 239
Epoch 239: val/epoch_NLL: 1380341.00 -- val/pos_mse: 1380103.50 -- val/X_kl: 1766.29 -- val/E_kl: 2462.86 -- val/charges_kl: 428.30 
Val loss: 1380341.0000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch239/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 548.62 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 80, Kekulize 2, other 0,  -- No error 942
Validity over 1024 molecules: 91.99%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 97.95
Uniqueness: 96.28% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 54.00%
rdkit valid pharmacophore match: 57.01%
rdkit pharmacophore match 2d: 77.83%
rdkit valid pharmacophore match 2d: 78.45%
pgmg pharmacophore match: 57.42%
pgmg valid pharmacophore match: 59.08%
pgmg pharmacophore match percentage: 42.97%
pgmg valid pharmacophore match percentage: 44.37%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.01, 'sampling/AtomTypesTV': 0.213, 'sampling/EdgeTypesTV': 0.074, 'sampling/ChargeW1': 0.016, 'sampling/ValencyW1': 0.19, 'sampling/BondLengthsW1': 0.021, 'sampling/AnglesW1': 7.132}
Sampling metrics done.
Val epoch 239 ends
Train epoch 239 ends
Epoch 239 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 741.8s 
Starting epoch 240
Train epoch 240 ends
Epoch 240 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.6s 
Starting epoch 241
Train epoch 241 ends
Epoch 241 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.3s 
Starting epoch 242
Train epoch 242 ends
Epoch 242 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.0s 
Starting epoch 243
Train epoch 243 ends
Epoch 243 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 244
Train epoch 244 ends
Epoch 244 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 164.7s 
Starting epoch 245
Train epoch 245 ends
Epoch 245 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.4s 
Starting epoch 246
Train epoch 246 ends
Epoch 246 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 247
Train epoch 247 ends
Epoch 247 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.1s 
Starting epoch 248
Train epoch 248 ends
Epoch 248 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.6s 
Starting epoch 249
Epoch 249: val/epoch_NLL: 5680674.00 -- val/pos_mse: 5680436.50 -- val/X_kl: 1735.93 -- val/E_kl: 2469.00 -- val/charges_kl: 432.92 
Val loss: 5680674.0000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch249/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 540.31 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 80, Kekulize 0, other 0,  -- No error 944
Validity over 1024 molecules: 92.19%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 98.73
Uniqueness: 97.25% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 53.22%
rdkit valid pharmacophore match: 54.77%
rdkit pharmacophore match 2d: 75.59%
rdkit valid pharmacophore match 2d: 75.64%
pgmg pharmacophore match: 57.76%
pgmg valid pharmacophore match: 58.93%
pgmg pharmacophore match percentage: 43.16%
pgmg valid pharmacophore match percentage: 44.28%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.01, 'sampling/AtomTypesTV': 0.195, 'sampling/EdgeTypesTV': 0.067, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.164, 'sampling/BondLengthsW1': 0.013, 'sampling/AnglesW1': 6.206}
Sampling metrics done.
Val epoch 249 ends
Train epoch 249 ends
Epoch 249 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 737.1s 
Starting epoch 250
Train epoch 250 ends
Epoch 250 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.5s 
Starting epoch 251
Train epoch 251 ends
Epoch 251 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 252
Train epoch 252 ends
Epoch 252 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 253
Train epoch 253 ends
Epoch 253 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 254
Train epoch 254 ends
Epoch 254 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.8s 
Starting epoch 255
Train epoch 255 ends
Epoch 255 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.3s 
Starting epoch 256
Train epoch 256 ends
Epoch 256 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 257
Train epoch 257 ends
Epoch 257 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 258
Train epoch 258 ends
Epoch 258 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.1s 
Starting epoch 259
Epoch 259: val/epoch_NLL: 4573963.50 -- val/pos_mse: 4573729.00 -- val/X_kl: 1712.14 -- val/E_kl: 2496.80 -- val/charges_kl: 386.54 
Val loss: 4573963.5000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch259/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 551.35 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 118, Kekulize 0, other 0,  -- No error 906
Validity over 1024 molecules: 88.48%
Number of connected components of 1024 molecules: mean:1.02 max:2.00
Connected components of 1024 molecules: 98.34
Uniqueness: 97.68% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 49.71%
rdkit valid pharmacophore match: 52.43%
rdkit pharmacophore match 2d: 74.22%
rdkit valid pharmacophore match 2d: 74.50%
pgmg pharmacophore match: 54.36%
pgmg valid pharmacophore match: 55.87%
pgmg pharmacophore match percentage: 38.18%
pgmg valid pharmacophore match percentage: 39.85%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.017, 'sampling/AtomTypesTV': 0.183, 'sampling/EdgeTypesTV': 0.067, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.159, 'sampling/BondLengthsW1': 0.015, 'sampling/AnglesW1': 6.911}
Sampling metrics done.
Val epoch 259 ends
Train epoch 259 ends
Epoch 259 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 744.2s 
Starting epoch 260
Train epoch 260 ends
Epoch 260 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 261
Train epoch 261 ends
Epoch 261 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 165.5s 
Starting epoch 262
Train epoch 262 ends
Epoch 262 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 263
Train epoch 263 ends
Epoch 263 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.3s 
Starting epoch 264
Train epoch 264 ends
Epoch 264 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.7s 
Starting epoch 265
Train epoch 265 ends
Epoch 265 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.4s 
Starting epoch 266
Train epoch 266 ends
Epoch 266 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 161.2s 
Starting epoch 267
Train epoch 267 ends
Epoch 267 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.0s 
Starting epoch 268
Train epoch 268 ends
Epoch 268 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.3s 
Starting epoch 269
Epoch 269: val/epoch_NLL: 9041487.00 -- val/pos_mse: 9041250.00 -- val/X_kl: 1744.75 -- val/E_kl: 2464.39 -- val/charges_kl: 414.05 
Val loss: 9041487.0000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch269/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 543.65 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 109, Kekulize 0, other 0,  -- No error 915
Validity over 1024 molecules: 89.36%
Number of connected components of 1024 molecules: mean:1.00 max:2.00
Connected components of 1024 molecules: 99.51
Uniqueness: 96.17% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 56.74%
rdkit valid pharmacophore match: 60.00%
rdkit pharmacophore match 2d: 79.10%
rdkit valid pharmacophore match 2d: 79.13%
pgmg pharmacophore match: 59.21%
pgmg valid pharmacophore match: 60.55%
pgmg pharmacophore match percentage: 42.38%
pgmg valid pharmacophore match percentage: 43.50%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.023, 'sampling/AtomTypesTV': 0.21, 'sampling/EdgeTypesTV': 0.062, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.227, 'sampling/BondLengthsW1': 0.012, 'sampling/AnglesW1': 5.151}
Sampling metrics done.
Val epoch 269 ends
Train epoch 269 ends
Epoch 269 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 739.0s 
Starting epoch 270
Train epoch 270 ends
Epoch 270 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 271
Train epoch 271 ends
Epoch 271 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 161.4s 
Starting epoch 272
Train epoch 272 ends
Epoch 272 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 273
Train epoch 273 ends
Epoch 273 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.8s 
Starting epoch 274
Train epoch 274 ends
Epoch 274 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 164.6s 
Starting epoch 275
Train epoch 275 ends
Epoch 275 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 163.4s 
Starting epoch 276
Train epoch 276 ends
Epoch 276 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.1s 
Starting epoch 277
Train epoch 277 ends
Epoch 277 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 160.5s 
Starting epoch 278
Train epoch 278 ends
Epoch 278 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.2s 
Starting epoch 279
Epoch 279: val/epoch_NLL: 7472369.50 -- val/pos_mse: 7472135.00 -- val/X_kl: 1728.73 -- val/E_kl: 2485.89 -- val/charges_kl: 391.88 
Val loss: 7472369.5000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch279/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 550.55 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 82, Kekulize 0, other 0,  -- No error 942
Validity over 1024 molecules: 91.99%
Number of connected components of 1024 molecules: mean:1.01 max:3.00
Connected components of 1024 molecules: 98.63
Uniqueness: 96.60% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 56.45%
rdkit valid pharmacophore match: 57.75%
rdkit pharmacophore match 2d: 80.57%
rdkit valid pharmacophore match 2d: 80.15%
pgmg pharmacophore match: 60.25%
pgmg valid pharmacophore match: 60.99%
pgmg pharmacophore match percentage: 44.24%
pgmg valid pharmacophore match percentage: 44.69%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.008, 'sampling/AtomTypesTV': 0.195, 'sampling/EdgeTypesTV': 0.062, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.168, 'sampling/BondLengthsW1': 0.014, 'sampling/AnglesW1': 6.231}
Sampling metrics done.
Val epoch 279 ends
Train epoch 279 ends
Epoch 279 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 744.0s 
Starting epoch 280
Train epoch 280 ends
Epoch 280 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.5s 
Starting epoch 281
Train epoch 281 ends
Epoch 281 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.2s 
Starting epoch 282
Train epoch 282 ends
Epoch 282 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 161.9s 
Starting epoch 283
Train epoch 283 ends
Epoch 283 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 163.3s 
Starting epoch 284
Train epoch 284 ends
Epoch 284 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 164.3s 
Starting epoch 285
Train epoch 285 ends
Epoch 285 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 163.0s 
Starting epoch 286
Train epoch 286 ends
Epoch 286 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 163.3s 
Starting epoch 287
Train epoch 287 ends
Epoch 287 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.0s 
Starting epoch 288
Train epoch 288 ends
Epoch 288 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.7s 
Starting epoch 289
Epoch 289: val/epoch_NLL: 3733646.50 -- val/pos_mse: 3733410.00 -- val/X_kl: 1737.51 -- val/E_kl: 2485.54 -- val/charges_kl: 423.74 
Val loss: 3733646.5000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch289/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 539.75 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 94, Kekulize 0, other 1,  -- No error 929
Validity over 1024 molecules: 90.72%
Number of connected components of 1024 molecules: mean:1.01 max:2.00
Connected components of 1024 molecules: 98.54
Uniqueness: 96.66% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 54.39%
rdkit valid pharmacophore match: 57.27%
rdkit pharmacophore match 2d: 78.61%
rdkit valid pharmacophore match 2d: 79.12%
pgmg pharmacophore match: 57.60%
pgmg valid pharmacophore match: 59.33%
pgmg pharmacophore match percentage: 42.38%
pgmg valid pharmacophore match percentage: 44.67%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.016, 'sampling/AtomTypesTV': 0.201, 'sampling/EdgeTypesTV': 0.058, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.177, 'sampling/BondLengthsW1': 0.014, 'sampling/AnglesW1': 5.804}
Sampling metrics done.
Val epoch 289 ends
Train epoch 289 ends
Epoch 289 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 737.5s 
Starting epoch 290
Train epoch 290 ends
Epoch 290 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.6s 
Starting epoch 291
Train epoch 291 ends
Epoch 291 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 165.3s 
Starting epoch 292
Train epoch 292 ends
Epoch 292 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.7s 
Starting epoch 293
Train epoch 293 ends
Epoch 293 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 163.5s 
Starting epoch 294
Train epoch 294 ends
Epoch 294 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 165.3s 
Starting epoch 295
Train epoch 295 ends
Epoch 295 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.9s 
Starting epoch 296
Train epoch 296 ends
Epoch 296 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 162.3s 
Starting epoch 297
Train epoch 297 ends
Epoch 297 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 161.2s 
Starting epoch 298
Train epoch 298 ends
Epoch 298 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 164.1s 
Starting epoch 299
Epoch 299: val/epoch_NLL: 9303660.00 -- val/pos_mse: 9303428.00 -- val/X_kl: 1718.10 -- val/E_kl: 2442.66 -- val/charges_kl: 357.32 
Val loss: 9303660.0000 	 Best val loss:  1380341.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-20/05-25-13-noh_ada3/chains/epoch299/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 551.98 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 74, Kekulize 0, other 0,  -- No error 950
Validity over 1024 molecules: 92.77%
Number of connected components of 1024 molecules: mean:1.02 max:3.00
Connected components of 1024 molecules: 97.85
Uniqueness: 96.00% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 56.35%
rdkit valid pharmacophore match: 58.00%
rdkit pharmacophore match 2d: 81.25%
rdkit valid pharmacophore match 2d: 81.79%
pgmg pharmacophore match: 58.97%
pgmg valid pharmacophore match: 60.47%
pgmg pharmacophore match percentage: 42.58%
pgmg valid pharmacophore match percentage: 44.21%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.017, 'sampling/AtomTypesTV': 0.201, 'sampling/EdgeTypesTV': 0.079, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.167, 'sampling/BondLengthsW1': 0.015, 'sampling/AnglesW1': 8.361}
Sampling metrics done.
Val epoch 299 ends
Train epoch 299 ends
Epoch 299 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 746.3s 
Starting epoch 300
Train epoch 300 ends
Epoch 300 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 162.8s 
Starting epoch 301
Train epoch 301 ends
Epoch 301 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 161.3s 
Starting epoch 302
Train epoch 302 ends
Epoch 302 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 165.3s 
Starting epoch 303
Train epoch 303 ends
Epoch 303 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 163.1s 
Starting epoch 304
Train epoch 304 ends
Epoch 304 finished: pos: 0.22 -- X: 0.16 -- charges: 0.03 -- E: 0.21 -- y: -1.00 -- 165.0s 
Starting epoch 305
Train epoch 305 ends
Epoch 305 finished: pos: 0.21 -- X: 0.16 -- charges: 0.03 -- E: 0.20 -- y: -1.00 -- 164.1s 
Starting epoch 306
Train epoch 306 ends
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-21 02:12:10,019][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-21 02:12:10,020][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 50.5 M
----------------------------------------------------------------
50.5 M    Trainable params
0         Non-trainable params
50.5 M    Total params
201.957   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-21/02-11-04-noh_ada3/wandb/run-20241021_021212-yc6tpj8g
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/yc6tpj8g
Error executing job with overrides: ['dataset=qm9', 'dataset.remove_h=True', '+experiment=qm9_no_h_adaptive']
Traceback (most recent call last):
  File "/home/amira/midi_two/MiDi/midi/main.py", line 101, in main
    trainer.fit(model, datamodule=datamodule, ckpt_path=cfg.general.resume)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1016, in _run_stage
    self._run_sanity_check()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1045, in _run_sanity_check
    val_loop.run()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 177, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 115, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 375, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_kwargs.values())
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/ddp.py", line 336, in validation_step
    return self.model(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/overrides/base.py", line 102, in forward
    return self._forward_module.validation_step(*inputs, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 129, in validation_step
    pred = self.forward(z_t, extra_data)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 560, in forward
    return self.model(model_input)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/models/transformer_model.py", line 445, in forward
    feats = self.mlp_in_feats(data.pharma_feat, data.pharma_atom)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
TypeError: forward() takes 2 positional arguments but 3 were given

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: - 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: \ 0.005 MB of 0.014 MB uploaded (0.000 MB deduped)wandb: | 0.005 MB of 0.018 MB uploaded (0.000 MB deduped)wandb: üöÄ View run noh_ada3 at: https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/yc6tpj8g
wandb: Synced 6 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20241021_021212-yc6tpj8g/logs
Global seed set to 42
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-21 17:18:24,541][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-21 17:18:24,541][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 50.7 M
----------------------------------------------------------------
50.7 M    Trainable params
0         Non-trainable params
50.7 M    Total params
202.769   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-21/17-17-19-noh_ada3/wandb/run-20241021_171826-wtkdulpj
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/wtkdulpj
Epoch 0: val/epoch_NLL: 2873916928.00 -- val/pos_mse: 2873911552.00 -- val/X_kl: 2464.53 -- val/E_kl: 5107.86 -- val/charges_kl: 3485.07 
Val loss: 2873916928.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-21 17:57:24,735][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-21 17:57:24,735][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 50.7 M
----------------------------------------------------------------
50.7 M    Trainable params
0         Non-trainable params
50.7 M    Total params
202.769   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-21/17-56-19-noh_ada3/wandb/run-20241021_175726-5iuv5ien
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/5iuv5ien
Epoch 0: val/epoch_NLL: 2873916928.00 -- val/pos_mse: 2873911552.00 -- val/X_kl: 2464.53 -- val/E_kl: 5107.86 -- val/charges_kl: 3485.07 
Val loss: 2873916928.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
wandb: ERROR Error while calling W&B API: context deadline exceeded (<Response [500]>)
wandb: ERROR Error while calling W&B API: context deadline exceeded (<Response [500]>)
wandb: ERROR Error while calling W&B API: context deadline exceeded (<Response [500]>)
Train epoch 0 ends
Epoch 0 finished: pos: 0.85 -- X: 0.62 -- charges: 0.13 -- E: 0.58 -- y: -1.00 -- 159.1s 
Starting epoch 1
Train epoch 1 ends
Epoch 1 finished: pos: 0.56 -- X: 0.59 -- charges: 0.12 -- E: 0.42 -- y: -1.00 -- 163.7s 
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: pos: 0.44 -- X: 0.57 -- charges: 0.12 -- E: 0.36 -- y: -1.00 -- 158.8s 
Starting epoch 3
Train epoch 3 ends
Epoch 3 finished: pos: 0.37 -- X: 0.56 -- charges: 0.11 -- E: 0.33 -- y: -1.00 -- 159.3s 
Starting epoch 4
Train epoch 4 ends
Epoch 4 finished: pos: 0.31 -- X: 0.54 -- charges: 0.11 -- E: 0.31 -- y: -1.00 -- 158.6s 
Starting epoch 5
Train epoch 5 ends
Epoch 5 finished: pos: 0.28 -- X: 0.47 -- charges: 0.10 -- E: 0.29 -- y: -1.00 -- 158.7s 
Starting epoch 6
Train epoch 6 ends
Epoch 6 finished: pos: 0.27 -- X: 0.33 -- charges: 0.08 -- E: 0.28 -- y: -1.00 -- 159.0s 
Starting epoch 7
Train epoch 7 ends
Epoch 7 finished: pos: 0.26 -- X: 0.27 -- charges: 0.07 -- E: 0.27 -- y: -1.00 -- 160.9s 
Starting epoch 8
Train epoch 8 ends
Epoch 8 finished: pos: 0.25 -- X: 0.25 -- charges: 0.07 -- E: 0.26 -- y: -1.00 -- 160.9s 
Starting epoch 9
Epoch 9: val/epoch_NLL: 21198738.00 -- val/pos_mse: 21198350.00 -- val/X_kl: 2910.41 -- val/E_kl: 3665.62 -- val/charges_kl: 1088.66 
Val loss: 21198738.0000 	 Best val loss:  21198738.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-21/17-56-19-noh_ada3/chains/epoch9/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 524.94 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 388, Kekulize 43, other 42,  -- No error 551
Validity over 1024 molecules: 53.81%
Number of connected components of 1024 molecules: mean:1.11 max:3.00
Connected components of 1024 molecules: 89.26
Uniqueness: 99.82% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 47.17%
rdkit valid pharmacophore match: 48.64%
rdkit pharmacophore match 2d: 75.49%
rdkit valid pharmacophore match 2d: 75.32%
pgmg pharmacophore match: 51.97%
pgmg valid pharmacophore match: 54.33%
pgmg pharmacophore match percentage: 35.45%
pgmg valid pharmacophore match percentage: 37.02%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.011, 'sampling/AtomTypesTV': 0.118, 'sampling/EdgeTypesTV': 0.035, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.158, 'sampling/BondLengthsW1': 0.066, 'sampling/AnglesW1': 13.599}
Sampling metrics done.
Val epoch 9 ends
Train epoch 9 ends
Epoch 9 finished: pos: 0.25 -- X: 0.24 -- charges: 0.06 -- E: 0.26 -- y: -1.00 -- 711.5s 
Starting epoch 10
Train epoch 10 ends
Epoch 10 finished: pos: 0.25 -- X: 0.23 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 158.7s 
Starting epoch 11
Train epoch 11 ends
Epoch 11 finished: pos: 0.25 -- X: 0.22 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 158.7s 
Starting epoch 12
Train epoch 12 ends
Epoch 12 finished: pos: 0.25 -- X: 0.22 -- charges: 0.06 -- E: 0.25 -- y: -1.00 -- 157.7s 
Starting epoch 13
Train epoch 13 ends
Epoch 13 finished: pos: 0.24 -- X: 0.21 -- charges: 0.06 -- E: 0.24 -- y: -1.00 -- 157.7s 
Starting epoch 14
Train epoch 14 ends
Epoch 14 finished: pos: 0.24 -- X: 0.21 -- charges: 0.06 -- E: 0.24 -- y: -1.00 -- 157.9s 
Starting epoch 15
Train epoch 15 ends
Epoch 15 finished: pos: 0.24 -- X: 0.21 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 161.0s 
Starting epoch 16
Train epoch 16 ends
Epoch 16 finished: pos: 0.24 -- X: 0.21 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 160.8s 
Starting epoch 17
Train epoch 17 ends
Epoch 17 finished: pos: 0.24 -- X: 0.21 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 158.7s 
Starting epoch 18
Train epoch 18 ends
Epoch 18 finished: pos: 0.24 -- X: 0.21 -- charges: 0.05 -- E: 0.24 -- y: -1.00 -- 157.6s 
Starting epoch 19
Epoch 19: val/epoch_NLL: 14232618.00 -- val/pos_mse: 14232278.00 -- val/X_kl: 2473.57 -- val/E_kl: 3298.39 -- val/charges_kl: 910.23 
Val loss: 14232618.0000 	 Best val loss:  14232618.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-21/17-56-19-noh_ada3/chains/epoch19/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 527.47 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 253, Kekulize 12, other 8,  -- No error 751
An error occurred: Invariant Violation
	upper bound not greater than lower bound
	Violation occurred on line 186 in file Code/GraphMol/DistGeomHelpers/BoundsMatrixBuilder.cpp
	Failed Expression: ub > lb
	RDKIT: 2023.03.2
	BOOST: 1_78

Validity over 1024 molecules: 73.34%
Number of connected components of 1024 molecules: mean:1.03 max:3.00
Connected components of 1024 molecules: 97.36
Uniqueness: 99.87% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 49.22%
rdkit valid pharmacophore match: 51.33%
rdkit pharmacophore match 2d: 73.93%
rdkit valid pharmacophore match 2d: 77.87%
pgmg pharmacophore match: 52.83%
pgmg valid pharmacophore match: 55.26%
pgmg pharmacophore match percentage: 37.01%
pgmg valid pharmacophore match percentage: 39.41%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.006, 'sampling/AtomTypesTV': 0.155, 'sampling/EdgeTypesTV': 0.069, 'sampling/ChargeW1': 0.009, 'sampling/ValencyW1': 0.146, 'sampling/BondLengthsW1': 0.044, 'sampling/AnglesW1': 6.714}
Sampling metrics done.
Val epoch 19 ends
Train epoch 19 ends
Epoch 19 finished: pos: 0.24 -- X: 0.20 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 716.8s 
Starting epoch 20
Train epoch 20 ends
Epoch 20 finished: pos: 0.24 -- X: 0.20 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 158.8s 
Starting epoch 21
Train epoch 21 ends
Epoch 21 finished: pos: 0.24 -- X: 0.20 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 157.9s 
Starting epoch 22
Train epoch 22 ends
Epoch 22 finished: pos: 0.24 -- X: 0.20 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 158.6s 
Starting epoch 23
Train epoch 23 ends
Epoch 23 finished: pos: 0.23 -- X: 0.20 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 158.7s 
Starting epoch 24
Train epoch 24 ends
Epoch 24 finished: pos: 0.24 -- X: 0.19 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 159.7s 
Starting epoch 25
Train epoch 25 ends
Epoch 25 finished: pos: 0.24 -- X: 0.19 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 160.7s 
Starting epoch 26
Train epoch 26 ends
Epoch 26 finished: pos: 0.23 -- X: 0.19 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 158.6s 
Starting epoch 27
Train epoch 27 ends
Epoch 27 finished: pos: 0.23 -- X: 0.19 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 157.8s 
Starting epoch 28
Train epoch 28 ends
Epoch 28 finished: pos: 0.23 -- X: 0.19 -- charges: 0.05 -- E: 0.23 -- y: -1.00 -- 158.7s 
Starting epoch 29
Epoch 29: val/epoch_NLL: 8017590.00 -- val/pos_mse: 8017283.00 -- val/X_kl: 2347.11 -- val/E_kl: 3034.97 -- val/charges_kl: 640.98 
Val loss: 8017590.0000 	 Best val loss:  8017590.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-21/17-56-19-noh_ada3/chains/epoch29/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 537.91 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 238, Kekulize 3, other 4,  -- No error 779
Validity over 1024 molecules: 76.07%
Number of connected components of 1024 molecules: mean:1.03 max:2.00
Global seed set to 42
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-21 19:59:37,332][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-21 19:59:37,332][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 50.5 M
----------------------------------------------------------------
50.5 M    Trainable params
0         Non-trainable params
50.5 M    Total params
201.967   Total estimated model params size (MB)
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-21 19:59:38,610][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-21 19:59:38,610][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 50.5 M
----------------------------------------------------------------
50.5 M    Trainable params
0         Non-trainable params
50.5 M    Total params
201.967   Total estimated model params size (MB)
wandb: W&B API key is configured. Use `wandb login --relogin` to force relogin
wandb: - Waiting for wandb.init()...wandb: W&B API key is configured. Use `wandb login --relogin` to force relogin
wandb: \ Waiting for wandb.init()...wandb: - Waiting for wandb.init()...wandb: | Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: / Waiting for wandb.init()...wandb: | Waiting for wandb.init()...wandb: - Waiting for wandb.init()...wandb: / Waiting for wandb.init()...wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: | Waiting for wandb.init()...wandb: / Waiting for wandb.init()...wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: | Waiting for wandb.init()...wandb: / Waiting for wandb.init()...wandb: - Waiting for wandb.init()...wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-21/19-58-29-noh_ada3/wandb/run-20241021_195945-dxku59in
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/dxku59in
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-22 01:16:04,758][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-22 01:16:04,758][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 50.5 M
----------------------------------------------------------------
50.5 M    Trainable params
0         Non-trainable params
50.5 M    Total params
201.961   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-22/01-15-00-noh_ada3/wandb/run-20241022_011606-dtqaq68b
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/dtqaq68b
Epoch 0: val/epoch_NLL: 1553136896.00 -- val/pos_mse: 1553132032.00 -- val/X_kl: 2584.66 -- val/E_kl: 4429.11 -- val/charges_kl: 2677.54 
Val loss: 1553136896.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-22 03:09:20,926][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-22 03:09:20,926][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.8 M
----------------------------------------------------------------
20.8 M    Trainable params
0         Non-trainable params
20.8 M    Total params
83.343    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-22/03-08-16-noh_ada3/wandb/run-20241022_030922-6vr0bosm
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/6vr0bosm
Error executing job with overrides: ['dataset=qm9', 'dataset.remove_h=True', '+experiment=qm9_no_h_adaptive']
Traceback (most recent call last):
  File "/home/amira/midi_two/MiDi/midi/main.py", line 101, in main
    trainer.fit(model, datamodule=datamodule, ckpt_path=cfg.general.resume)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1016, in _run_stage
    self._run_sanity_check()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1045, in _run_sanity_check
    val_loop.run()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 177, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 115, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 375, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_kwargs.values())
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/ddp.py", line 336, in validation_step
    return self.model(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/overrides/base.py", line 102, in forward
    return self._forward_module.validation_step(*inputs, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 129, in validation_step
    pred = self.forward(z_t, extra_data)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 560, in forward
    return self.model(model_input)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/models/transformer_model.py", line 466, in forward
    new_X = self.mlp_in_X(X_all)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (8192x21 and 17x256)

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: - 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: \ 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: | 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: üöÄ View run noh_ada3 at: https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/6vr0bosm
wandb: Synced 6 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20241022_030922-6vr0bosm/logs
Global seed set to 42
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 80862, 8: 13044, 7: 2185, 6: 423, 5: 65, 4: 15, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16499, 8: 2742, 7: 483, 6: 66, 5: 17, 4: 3})
NUM NODES IN STATISTICS Counter({9: 10756, 8: 1782, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7232, 0.1138, 0.1605, 0.0025]) -- edges: tensor([0.7263, 0.2383, 0.0272, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9703, 0.0219])
[2024-10-22 03:15:39,599][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-22 03:15:39,600][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.8 M
----------------------------------------------------------------
20.8 M    Trainable params
0         Non-trainable params
20.8 M    Total params
83.343    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-22/03-14-33-noh_ada3/wandb/run-20241022_031541-znvbc88q
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/znvbc88q
Error executing job with overrides: ['dataset=qm9', 'dataset.remove_h=True', '+experiment=qm9_no_h_adaptive']
Traceback (most recent call last):
  File "/home/amira/midi_two/MiDi/midi/main.py", line 101, in main
    trainer.fit(model, datamodule=datamodule, ckpt_path=cfg.general.resume)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 531, in fit
    call._call_and_handle_interrupt(
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 41, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 91, in launch
    return function(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 570, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 975, in _run
    results = self._run_stage()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1016, in _run_stage
    self._run_sanity_check()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1045, in _run_sanity_check
    val_loop.run()
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 177, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 115, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 375, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_kwargs.values())
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 287, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/strategies/ddp.py", line 336, in validation_step
    return self.model(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/overrides/base.py", line 102, in forward
    return self._forward_module.validation_step(*inputs, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 129, in validation_step
    pred = self.forward(z_t, extra_data)
  File "/home/amira/midi_two/MiDi/midi/diffusion_model.py", line 560, in forward
    return self.model(model_input)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/midi_two/MiDi/midi/models/transformer_model.py", line 467, in forward
    new_X = self.mlp_in_X(X_all)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/container.py", line 217, in forward
    input = module(input)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (8192x21 and 17x256)

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: - 0.005 MB of 0.005 MB uploaded (0.000 MB deduped)wandb: \ 0.005 MB of 0.014 MB uploaded (0.000 MB deduped)wandb: | 0.018 MB of 0.018 MB uploaded (0.000 MB deduped)wandb: üöÄ View run noh_ada3 at: https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/znvbc88q
wandb: Synced 6 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20241022_031541-znvbc88q/logs
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81126, 8: 13122, 7: 2228, 6: 437, 5: 76, 4: 16, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16552, 8: 2762, 7: 488, 6: 68, 5: 17, 4: 5})
NUM NODES IN STATISTICS Counter({9: 10786, 8: 1796, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7244, 0.1132, 0.1599, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-10-25 02:53:25,084][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-25 02:53:25,084][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.8 M
----------------------------------------------------------------
20.8 M    Trainable params
0         Non-trainable params
20.8 M    Total params
83.342    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-25/02-52-18-noh_ada3/wandb/run-20241025_025326-azhymc58
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/azhymc58
Epoch 0: val/epoch_NLL: 466757440.00 -- val/pos_mse: 466752640.00 -- val/X_kl: 2978.68 -- val/E_kl: 4077.40 -- val/charges_kl: 2605.57 
Val loss: 466757440.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81126, 8: 13122, 7: 2228, 6: 437, 5: 76, 4: 16, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16552, 8: 2762, 7: 488, 6: 68, 5: 17, 4: 5})
NUM NODES IN STATISTICS Counter({9: 10786, 8: 1796, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7244, 0.1132, 0.1599, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-10-25 03:14:55,381][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-25 03:14:55,381][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 20.8 M
----------------------------------------------------------------
20.8 M    Trainable params
0         Non-trainable params
20.8 M    Total params
83.342    Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-25/03-13-49-noh_ada3/wandb/run-20241025_031457-jvts1ogp
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/jvts1ogp
Epoch 0: val/epoch_NLL: 466757440.00 -- val/pos_mse: 466752640.00 -- val/X_kl: 2978.68 -- val/E_kl: 4077.40 -- val/charges_kl: 2605.57 
Val loss: 466757440.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Global seed set to 42
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/torch_geometric/data/lightning/datamodule.py:49: UserWarning: The 'shuffle=True' option is ignored in 'QM9DataModule'. Remove it from the argument list to disable this warning
  warnings.warn(f"The 'shuffle={kwargs['shuffle']}' option is "
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
/home/amira/.conda/envs/midi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:67: UserWarning: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
  warning_cache.warn(
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
NUM NODES IN STATISTICS Counter({9: 81126, 8: 13122, 7: 2228, 6: 437, 5: 76, 4: 16, 3: 4})
NUM NODES IN STATISTICS Counter({9: 16552, 8: 2762, 7: 488, 6: 68, 5: 17, 4: 5})
NUM NODES IN STATISTICS Counter({9: 10786, 8: 1796, 7: 302, 6: 65, 5: 13, 4: 3})
Marginal distribution of the classes: nodes: tensor([0.7244, 0.1132, 0.1599, 0.0025]) -- edges: tensor([0.7261, 0.2386, 0.0271, 0.0082, 0.0000]) -- charges: tensor([0.0077, 0.9705, 0.0218])
[2024-10-26 12:40:04,338][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-10-26 12:40:04,338][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA GeForce RTX 3090 Ti') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 27.6 M
----------------------------------------------------------------
27.6 M    Trainable params
0         Non-trainable params
27.6 M    Total params
110.476   Total estimated model params size (MB)
wandb: Currently logged in as: aalakhda (edm_10708). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.18.5 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/wandb/run-20241026_124006-2dwau1b8
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run noh_ada3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9
wandb: üöÄ View run at https://wandb.ai/edm_10708/MolDiffusion_pharmacophoreqm9/runs/2dwau1b8
Epoch 0: val/epoch_NLL: 697890816.00 -- val/pos_mse: 697885376.00 -- val/X_kl: 3395.51 -- val/E_kl: 4447.31 -- val/charges_kl: 2995.54 
Val loss: 697890816.0000 	 Best val loss:  100000000.0000

Val epoch 0 ends
Starting epoch 0
Train epoch 0 ends
Epoch 0 finished: pos: 0.45 -- X: 0.65 -- charges: 0.14 -- E: 0.60 -- y: -1.00 -- 144.3s p_pos: 0.47 -- p_X: 0.64 -- p_charges: 0.15 -- 
Starting epoch 1
Train epoch 1 ends
Epoch 1 finished: pos: 0.40 -- X: 0.55 -- charges: 0.11 -- E: 0.41 -- y: -1.00 -- 142.8s p_pos: 0.40 -- p_X: 0.38 -- p_charges: 0.08 -- 
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: pos: 0.40 -- X: 0.42 -- charges: 0.09 -- E: 0.36 -- y: -1.00 -- 142.0s p_pos: 0.40 -- p_X: 0.13 -- p_charges: 0.04 -- 
Starting epoch 3
Train epoch 3 ends
Epoch 3 finished: pos: 0.39 -- X: 0.36 -- charges: 0.08 -- E: 0.34 -- y: -1.00 -- 141.4s p_pos: 0.39 -- p_X: 0.06 -- p_charges: 0.02 -- 
Starting epoch 4
Train epoch 4 ends
Epoch 4 finished: pos: 0.39 -- X: 0.33 -- charges: 0.07 -- E: 0.32 -- y: -1.00 -- 140.4s p_pos: 0.39 -- p_X: 0.04 -- p_charges: 0.02 -- 
Starting epoch 5
Train epoch 5 ends
Epoch 5 finished: pos: 0.38 -- X: 0.31 -- charges: 0.07 -- E: 0.30 -- y: -1.00 -- 140.4s p_pos: 0.38 -- p_X: 0.03 -- p_charges: 0.01 -- 
Starting epoch 6
Train epoch 6 ends
Epoch 6 finished: pos: 0.38 -- X: 0.29 -- charges: 0.06 -- E: 0.29 -- y: -1.00 -- 140.1s p_pos: 0.38 -- p_X: 0.02 -- p_charges: 0.01 -- 
Starting epoch 7
Train epoch 7 ends
Epoch 7 finished: pos: 0.38 -- X: 0.28 -- charges: 0.06 -- E: 0.28 -- y: -1.00 -- 140.3s p_pos: 0.38 -- p_X: 0.02 -- p_charges: 0.01 -- 
Starting epoch 8
Train epoch 8 ends
Epoch 8 finished: pos: 0.38 -- X: 0.27 -- charges: 0.06 -- E: 0.28 -- y: -1.00 -- 140.5s p_pos: 0.38 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 9
Epoch 9: val/epoch_NLL: 4368026.00 -- val/pos_mse: 4367604.00 -- val/X_kl: 3478.97 -- val/E_kl: 4041.32 -- val/charges_kl: 839.49 
Val loss: 4368026.0000 	 Best val loss:  4368026.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch9/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 496.68 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 446, Kekulize 35, other 49,  -- No error 494
Validity over 1024 molecules: 48.24%
Number of connected components of 1024 molecules: mean:1.71 max:5.00
Connected components of 1024 molecules: 50.39
Uniqueness: 97.17% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 50.78%
rdkit valid pharmacophore match: 47.17%
rdkit pharmacophore match 2d: 76.95%
rdkit valid pharmacophore match 2d: 81.60%
pgmg pharmacophore match: 57.93%
pgmg valid pharmacophore match: 55.97%
pgmg pharmacophore match percentage: 46.58%
pgmg valid pharmacophore match percentage: 44.53%
Sparsity level on local rank 0: 75 %
Sampling metrics {'sampling/NumNodesW1': 0.01, 'sampling/AtomTypesTV': 0.054, 'sampling/EdgeTypesTV': 0.065, 'sampling/ChargeW1': 0.006, 'sampling/ValencyW1': 0.365, 'sampling/BondLengthsW1': 0.06, 'sampling/AnglesW1': 14.198}
Sampling metrics done.
Val epoch 9 ends
Train epoch 9 ends
Epoch 9 finished: pos: 0.38 -- X: 0.26 -- charges: 0.05 -- E: 0.27 -- y: -1.00 -- 663.4s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 10
Train epoch 10 ends
Epoch 10 finished: pos: 0.37 -- X: 0.25 -- charges: 0.05 -- E: 0.27 -- y: -1.00 -- 141.2s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 11
Train epoch 11 ends
Epoch 11 finished: pos: 0.38 -- X: 0.25 -- charges: 0.05 -- E: 0.27 -- y: -1.00 -- 140.5s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 12
Train epoch 12 ends
Epoch 12 finished: pos: 0.37 -- X: 0.24 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 140.3s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 13
Train epoch 13 ends
Epoch 13 finished: pos: 0.37 -- X: 0.24 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 140.3s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 14
Train epoch 14 ends
Epoch 14 finished: pos: 0.37 -- X: 0.24 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 140.3s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 15
Train epoch 15 ends
Epoch 15 finished: pos: 0.37 -- X: 0.23 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 143.0s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 16
Train epoch 16 ends
Epoch 16 finished: pos: 0.37 -- X: 0.23 -- charges: 0.05 -- E: 0.26 -- y: -1.00 -- 140.5s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 17
Train epoch 17 ends
Epoch 17 finished: pos: 0.37 -- X: 0.23 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 140.3s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.01 -- 
Starting epoch 18
Train epoch 18 ends
Epoch 18 finished: pos: 0.37 -- X: 0.23 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 140.4s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.00 -- 
Starting epoch 19
Epoch 19: val/epoch_NLL: 1374879.75 -- val/pos_mse: 1374498.38 -- val/X_kl: 3099.85 -- val/E_kl: 3600.84 -- val/charges_kl: 846.81 
Val loss: 1374879.7500 	 Best val loss:  1374879.7500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch19/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 518.54 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 507, Kekulize 7, other 11,  -- No error 499
Validity over 1024 molecules: 48.73%
Number of connected components of 1024 molecules: mean:1.21 max:4.00
Connected components of 1024 molecules: 80.96
Uniqueness: 99.40% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 60.64%
rdkit valid pharmacophore match: 62.12%
rdkit pharmacophore match 2d: 82.22%
rdkit valid pharmacophore match 2d: 83.58%
pgmg pharmacophore match: 65.06%
pgmg valid pharmacophore match: 65.87%
pgmg pharmacophore match percentage: 53.42%
pgmg valid pharmacophore match percentage: 55.31%
Sparsity level on local rank 0: 72 %
Sampling metrics {'sampling/NumNodesW1': 0.007, 'sampling/AtomTypesTV': 0.121, 'sampling/EdgeTypesTV': 0.032, 'sampling/ChargeW1': 0.014, 'sampling/ValencyW1': 0.254, 'sampling/BondLengthsW1': 0.038, 'sampling/AnglesW1': 14.127}
Sampling metrics done.
Val epoch 19 ends
Train epoch 19 ends
Epoch 19 finished: pos: 0.37 -- X: 0.23 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 686.3s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.00 -- 
Starting epoch 20
Train epoch 20 ends
Epoch 20 finished: pos: 0.37 -- X: 0.22 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 141.1s p_pos: 0.37 -- p_X: 0.01 -- p_charges: 0.00 -- 
Starting epoch 21
Train epoch 21 ends
Epoch 21 finished: pos: 0.37 -- X: 0.22 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 140.3s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 22
Train epoch 22 ends
Epoch 22 finished: pos: 0.37 -- X: 0.22 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 143.3s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 23
Train epoch 23 ends
Epoch 23 finished: pos: 0.37 -- X: 0.22 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 140.0s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 24
Train epoch 24 ends
Epoch 24 finished: pos: 0.37 -- X: 0.22 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 141.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 25
Train epoch 25 ends
Epoch 25 finished: pos: 0.37 -- X: 0.22 -- charges: 0.05 -- E: 0.25 -- y: -1.00 -- 140.1s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 26
Train epoch 26 ends
Epoch 26 finished: pos: 0.37 -- X: 0.22 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.4s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 27
Train epoch 27 ends
Epoch 27 finished: pos: 0.37 -- X: 0.22 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 28
Train epoch 28 ends
Epoch 28 finished: pos: 0.37 -- X: 0.22 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 29
Epoch 29: val/epoch_NLL: 1042537.44 -- val/pos_mse: 1042185.56 -- val/X_kl: 2897.42 -- val/E_kl: 3426.47 -- val/charges_kl: 662.99 
Val loss: 1042537.4375 	 Best val loss:  1042537.4375

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch29/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 513.02 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 545, Kekulize 4, other 1,  -- No error 474
Validity over 1024 molecules: 46.29%
Number of connected components of 1024 molecules: mean:1.09 max:4.00
Connected components of 1024 molecules: 91.41
Uniqueness: 100.00% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 59.77%
rdkit valid pharmacophore match: 64.98%
rdkit pharmacophore match 2d: 81.96%
rdkit valid pharmacophore match 2d: 83.80%
pgmg pharmacophore match: 65.12%
pgmg valid pharmacophore match: 69.09%
pgmg pharmacophore match percentage: 54.00%
pgmg valid pharmacophore match percentage: 59.70%
Sparsity level on local rank 0: 71 %
Sampling metrics {'sampling/NumNodesW1': 0.018, 'sampling/AtomTypesTV': 0.15, 'sampling/EdgeTypesTV': 0.041, 'sampling/ChargeW1': 0.008, 'sampling/ValencyW1': 0.323, 'sampling/BondLengthsW1': 0.049, 'sampling/AnglesW1': 13.072}
Sampling metrics done.
Val epoch 29 ends
Train epoch 29 ends
Epoch 29 finished: pos: 0.37 -- X: 0.22 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 680.9s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 30
Train epoch 30 ends
Epoch 30 finished: pos: 0.37 -- X: 0.22 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 141.1s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 31
Train epoch 31 ends
Epoch 31 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 143.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 32
Train epoch 32 ends
Epoch 32 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.4s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 33
Train epoch 33 ends
Epoch 33 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 34
Train epoch 34 ends
Epoch 34 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 35
Train epoch 35 ends
Epoch 35 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 36
Train epoch 36 ends
Epoch 36 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 37
Train epoch 37 ends
Epoch 37 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 38
Train epoch 38 ends
Epoch 38 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 39
Epoch 39: val/epoch_NLL: 894659.75 -- val/pos_mse: 894315.00 -- val/X_kl: 2905.89 -- val/E_kl: 3127.50 -- val/charges_kl: 785.75 
Val loss: 894659.7500 	 Best val loss:  894659.7500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch39/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 510.31 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 354, Kekulize 4, other 3,  -- No error 663
Validity over 1024 molecules: 64.75%
Number of connected components of 1024 molecules: mean:1.16 max:4.00
Connected components of 1024 molecules: 85.74
Uniqueness: 99.85% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 59.86%
rdkit valid pharmacophore match: 62.29%
rdkit pharmacophore match 2d: 81.76%
rdkit valid pharmacophore match 2d: 83.56%
pgmg pharmacophore match: 65.72%
pgmg valid pharmacophore match: 67.62%
pgmg pharmacophore match percentage: 54.59%
pgmg valid pharmacophore match percentage: 56.86%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.016, 'sampling/AtomTypesTV': 0.203, 'sampling/EdgeTypesTV': 0.04, 'sampling/ChargeW1': 0.006, 'sampling/ValencyW1': 0.182, 'sampling/BondLengthsW1': 0.038, 'sampling/AnglesW1': 9.167}
Sampling metrics done.
Val epoch 39 ends
Train epoch 39 ends
Epoch 39 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 678.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 40
Train epoch 40 ends
Epoch 40 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 141.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 41
Train epoch 41 ends
Epoch 41 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 143.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 42
Train epoch 42 ends
Epoch 42 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 43
Train epoch 43 ends
Epoch 43 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 44
Train epoch 44 ends
Epoch 44 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 45
Train epoch 45 ends
Epoch 45 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 142.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 46
Train epoch 46 ends
Epoch 46 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.24 -- y: -1.00 -- 140.2s p_pos: 0.37 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 47
Train epoch 47 ends
Epoch 47 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 48
Train epoch 48 ends
Epoch 48 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 49
Epoch 49: val/epoch_NLL: 1280201.12 -- val/pos_mse: 1279875.12 -- val/X_kl: 2618.04 -- val/E_kl: 3126.83 -- val/charges_kl: 712.42 
Val loss: 1280201.1250 	 Best val loss:  894659.7500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch49/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 507.64 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 383, Kekulize 9, other 2,  -- No error 630
Validity over 1024 molecules: 61.52%
Number of connected components of 1024 molecules: mean:1.13 max:4.00
Connected components of 1024 molecules: 87.99
Uniqueness: 100.00% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 62.21%
rdkit valid pharmacophore match: 67.62%
rdkit pharmacophore match 2d: 83.47%
rdkit valid pharmacophore match 2d: 86.95%
pgmg pharmacophore match: 68.83%
pgmg valid pharmacophore match: 73.12%
pgmg pharmacophore match percentage: 57.81%
pgmg valid pharmacophore match percentage: 63.02%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.011, 'sampling/AtomTypesTV': 0.193, 'sampling/EdgeTypesTV': 0.064, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.179, 'sampling/BondLengthsW1': 0.027, 'sampling/AnglesW1': 11.645}
Sampling metrics done.
Val epoch 49 ends
Train epoch 49 ends
Epoch 49 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 674.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 50
Train epoch 50 ends
Epoch 50 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 141.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 51
Train epoch 51 ends
Epoch 51 finished: pos: 0.37 -- X: 0.21 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 143.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 52
Train epoch 52 ends
Epoch 52 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 53
Train epoch 53 ends
Epoch 53 finished: pos: 0.36 -- X: 0.21 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 54
Train epoch 54 ends
Epoch 54 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 55
Train epoch 55 ends
Epoch 55 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 139.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 56
Train epoch 56 ends
Epoch 56 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 57
Train epoch 57 ends
Epoch 57 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 139.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 58
Train epoch 58 ends
Epoch 58 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 59
Epoch 59: val/epoch_NLL: 862955.25 -- val/pos_mse: 862644.94 -- val/X_kl: 2514.08 -- val/E_kl: 2989.88 -- val/charges_kl: 629.10 
Val loss: 862955.2500 	 Best val loss:  862955.2500

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch59/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 511.85 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 279, Kekulize 0, other 2,  -- No error 743
Validity over 1024 molecules: 72.56%
Number of connected components of 1024 molecules: mean:1.12 max:3.00
Connected components of 1024 molecules: 89.16
Uniqueness: 99.60% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 66.99%
rdkit valid pharmacophore match: 71.60%
rdkit pharmacophore match 2d: 85.64%
rdkit valid pharmacophore match 2d: 88.17%
pgmg pharmacophore match: 71.63%
pgmg valid pharmacophore match: 76.36%
pgmg pharmacophore match percentage: 61.43%
pgmg valid pharmacophore match percentage: 67.43%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.01, 'sampling/AtomTypesTV': 0.175, 'sampling/EdgeTypesTV': 0.068, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.141, 'sampling/BondLengthsW1': 0.035, 'sampling/AnglesW1': 8.797}
Sampling metrics done.
Val epoch 59 ends
Train epoch 59 ends
Epoch 59 finished: pos: 0.37 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 679.6s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 60
Train epoch 60 ends
Epoch 60 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 61
Train epoch 61 ends
Epoch 61 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 143.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 62
Train epoch 62 ends
Epoch 62 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 139.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 63
Train epoch 63 ends
Epoch 63 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 141.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 64
Train epoch 64 ends
Epoch 64 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 65
Train epoch 65 ends
Epoch 65 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 139.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 66
Train epoch 66 ends
Epoch 66 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 139.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 67
Train epoch 67 ends
Epoch 67 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 68
Train epoch 68 ends
Epoch 68 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 69
Epoch 69: val/epoch_NLL: 721660.00 -- val/pos_mse: 721347.75 -- val/X_kl: 2477.59 -- val/E_kl: 3084.69 -- val/charges_kl: 609.54 
Val loss: 721660.0000 	 Best val loss:  721660.0000

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch69/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 506.29 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 309, Kekulize 2, other 2,  -- No error 711
Validity over 1024 molecules: 69.43%
Number of connected components of 1024 molecules: mean:1.08 max:3.00
Connected components of 1024 molecules: 93.16
Uniqueness: 99.86% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 60.06%
rdkit valid pharmacophore match: 65.26%
rdkit pharmacophore match 2d: 81.67%
rdkit valid pharmacophore match 2d: 84.64%
pgmg pharmacophore match: 66.11%
pgmg valid pharmacophore match: 70.02%
pgmg pharmacophore match percentage: 56.45%
pgmg valid pharmacophore match percentage: 60.48%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.036, 'sampling/AtomTypesTV': 0.201, 'sampling/EdgeTypesTV': 0.063, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.229, 'sampling/BondLengthsW1': 0.027, 'sampling/AnglesW1': 6.404}
Sampling metrics done.
Val epoch 69 ends
Train epoch 69 ends
Epoch 69 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 674.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 70
Train epoch 70 ends
Epoch 70 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 71
Train epoch 71 ends
Epoch 71 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 143.1s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 72
Train epoch 72 ends
Epoch 72 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 73
Train epoch 73 ends
Epoch 73 finished: pos: 0.37 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 139.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 74
Train epoch 74 ends
Epoch 74 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 141.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 75
Train epoch 75 ends
Epoch 75 finished: pos: 0.37 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 76
Train epoch 76 ends
Epoch 76 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 77
Train epoch 77 ends
Epoch 77 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 78
Train epoch 78 ends
Epoch 78 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 79
Epoch 79: val/epoch_NLL: 456234.22 -- val/pos_mse: 455927.72 -- val/X_kl: 2474.82 -- val/E_kl: 2966.37 -- val/charges_kl: 626.86 
Val loss: 456234.2188 	 Best val loss:  456234.2188

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch79/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 515.79 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 219, Kekulize 0, other 1,  -- No error 804
Validity over 1024 molecules: 78.52%
Number of connected components of 1024 molecules: mean:1.06 max:3.00
Connected components of 1024 molecules: 94.43
Uniqueness: 99.13% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 65.04%
rdkit valid pharmacophore match: 68.16%
rdkit pharmacophore match 2d: 84.72%
rdkit valid pharmacophore match 2d: 86.87%
pgmg pharmacophore match: 71.09%
pgmg valid pharmacophore match: 73.71%
pgmg pharmacophore match percentage: 60.84%
pgmg valid pharmacophore match percentage: 63.56%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.014, 'sampling/AtomTypesTV': 0.176, 'sampling/EdgeTypesTV': 0.053, 'sampling/ChargeW1': 0.013, 'sampling/ValencyW1': 0.175, 'sampling/BondLengthsW1': 0.024, 'sampling/AnglesW1': 5.959}
Sampling metrics done.
Val epoch 79 ends
Train epoch 79 ends
Epoch 79 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 687.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 80
Train epoch 80 ends
Epoch 80 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.9s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 81
Train epoch 81 ends
Epoch 81 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 82
Train epoch 82 ends
Epoch 82 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 83
Train epoch 83 ends
Epoch 83 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 84
Train epoch 84 ends
Epoch 84 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 85
Train epoch 85 ends
Epoch 85 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 86
Train epoch 86 ends
Epoch 86 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 87
Train epoch 87 ends
Epoch 87 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 88
Train epoch 88 ends
Epoch 88 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 89
Epoch 89: val/epoch_NLL: 442020.56 -- val/pos_mse: 441722.34 -- val/X_kl: 2401.17 -- val/E_kl: 2918.71 -- val/charges_kl: 573.14 
Val loss: 442020.5625 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch89/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 506.69 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 164, Kekulize 0, other 1,  -- No error 859
Validity over 1024 molecules: 83.89%
Number of connected components of 1024 molecules: mean:1.08 max:3.00
Connected components of 1024 molecules: 92.09
Uniqueness: 99.53% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 62.30%
rdkit valid pharmacophore match: 63.56%
rdkit pharmacophore match 2d: 84.42%
rdkit valid pharmacophore match 2d: 85.66%
pgmg pharmacophore match: 69.35%
pgmg valid pharmacophore match: 70.29%
pgmg pharmacophore match percentage: 58.20%
pgmg valid pharmacophore match percentage: 59.37%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.003, 'sampling/AtomTypesTV': 0.206, 'sampling/EdgeTypesTV': 0.08, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.137, 'sampling/BondLengthsW1': 0.037, 'sampling/AnglesW1': 6.336}
Sampling metrics done.
Val epoch 89 ends
Train epoch 89 ends
Epoch 89 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 678.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 90
Train epoch 90 ends
Epoch 90 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 91
Train epoch 91 ends
Epoch 91 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 143.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 92
Train epoch 92 ends
Epoch 92 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 93
Train epoch 93 ends
Epoch 93 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 94
Train epoch 94 ends
Epoch 94 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 95
Train epoch 95 ends
Epoch 95 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 139.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 96
Train epoch 96 ends
Epoch 96 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 97
Train epoch 97 ends
Epoch 97 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 98
Train epoch 98 ends
Epoch 98 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 99
Epoch 99: val/epoch_NLL: 1242443.75 -- val/pos_mse: 1242152.75 -- val/X_kl: 2369.00 -- val/E_kl: 2814.59 -- val/charges_kl: 560.18 
Val loss: 1242443.7500 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch99/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 504.18 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 154, Kekulize 0, other 0,  -- No error 870
Validity over 1024 molecules: 84.96%
Number of connected components of 1024 molecules: mean:1.07 max:3.00
Connected components of 1024 molecules: 94.04
Uniqueness: 98.74% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 66.02%
rdkit valid pharmacophore match: 68.85%
rdkit pharmacophore match 2d: 86.01%
rdkit valid pharmacophore match 2d: 87.61%
pgmg pharmacophore match: 72.20%
pgmg valid pharmacophore match: 74.64%
pgmg pharmacophore match percentage: 60.55%
pgmg valid pharmacophore match percentage: 63.33%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.029, 'sampling/AtomTypesTV': 0.142, 'sampling/EdgeTypesTV': 0.062, 'sampling/ChargeW1': 0.009, 'sampling/ValencyW1': 0.077, 'sampling/BondLengthsW1': 0.019, 'sampling/AnglesW1': 6.55}
Sampling metrics done.
Val epoch 99 ends
Train epoch 99 ends
Epoch 99 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 673.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 100
Train epoch 100 ends
Epoch 100 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 101
Train epoch 101 ends
Epoch 101 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 102
Train epoch 102 ends
Epoch 102 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 143.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 103
Train epoch 103 ends
Epoch 103 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.23 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 104
Train epoch 104 ends
Epoch 104 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 105
Train epoch 105 ends
Epoch 105 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.5s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 106
Train epoch 106 ends
Epoch 106 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 107
Train epoch 107 ends
Epoch 107 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.7s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 108
Train epoch 108 ends
Epoch 108 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 109
Epoch 109: val/epoch_NLL: 793197.69 -- val/pos_mse: 792905.31 -- val/X_kl: 2333.89 -- val/E_kl: 2877.42 -- val/charges_kl: 568.64 
Val loss: 793197.6875 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch109/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 497.17 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 175, Kekulize 0, other 1,  -- No error 848
Validity over 1024 molecules: 82.81%
Number of connected components of 1024 molecules: mean:1.06 max:3.00
Connected components of 1024 molecules: 94.34
Uniqueness: 99.29% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 66.31%
rdkit valid pharmacophore match: 69.81%
rdkit pharmacophore match 2d: 84.95%
rdkit valid pharmacophore match 2d: 87.12%
pgmg pharmacophore match: 71.92%
pgmg valid pharmacophore match: 74.88%
pgmg pharmacophore match percentage: 62.99%
pgmg valid pharmacophore match percentage: 66.27%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.012, 'sampling/AtomTypesTV': 0.182, 'sampling/EdgeTypesTV': 0.059, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.174, 'sampling/BondLengthsW1': 0.02, 'sampling/AnglesW1': 6.249}
Sampling metrics done.
Val epoch 109 ends
Train epoch 109 ends
Epoch 109 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 664.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 110
Train epoch 110 ends
Epoch 110 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 111
Train epoch 111 ends
Epoch 111 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 112
Train epoch 112 ends
Epoch 112 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 113
Train epoch 113 ends
Epoch 113 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 114
Train epoch 114 ends
Epoch 114 finished: pos: 0.36 -- X: 0.20 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 115
Train epoch 115 ends
Epoch 115 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 116
Train epoch 116 ends
Epoch 116 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 117
Train epoch 117 ends
Epoch 117 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.5s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 118
Train epoch 118 ends
Epoch 118 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 119
Epoch 119: val/epoch_NLL: 713374.19 -- val/pos_mse: 713084.06 -- val/X_kl: 2391.96 -- val/E_kl: 2751.66 -- val/charges_kl: 584.20 
Val loss: 713374.1875 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch119/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 510.60 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 179, Kekulize 0, other 0,  -- No error 845
Validity over 1024 molecules: 82.52%
Number of connected components of 1024 molecules: mean:1.08 max:4.00
Connected components of 1024 molecules: 93.75
Uniqueness: 98.93% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 64.26%
rdkit valid pharmacophore match: 67.69%
rdkit pharmacophore match 2d: 84.49%
rdkit valid pharmacophore match 2d: 86.43%
pgmg pharmacophore match: 70.51%
pgmg valid pharmacophore match: 72.72%
pgmg pharmacophore match percentage: 60.74%
pgmg valid pharmacophore match percentage: 63.20%
Sparsity level on local rank 0: 73 %
Sampling metrics {'sampling/NumNodesW1': 0.028, 'sampling/AtomTypesTV': 0.211, 'sampling/EdgeTypesTV': 0.057, 'sampling/ChargeW1': 0.014, 'sampling/ValencyW1': 0.131, 'sampling/BondLengthsW1': 0.014, 'sampling/AnglesW1': 7.175}
Sampling metrics done.
Val epoch 119 ends
Train epoch 119 ends
Epoch 119 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 681.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 120
Train epoch 120 ends
Epoch 120 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.5s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 121
Train epoch 121 ends
Epoch 121 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 122
Train epoch 122 ends
Epoch 122 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 123
Train epoch 123 ends
Epoch 123 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 124
Train epoch 124 ends
Epoch 124 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 143.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 125
Train epoch 125 ends
Epoch 125 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 126
Train epoch 126 ends
Epoch 126 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.7s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 127
Train epoch 127 ends
Epoch 127 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.9s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 128
Train epoch 128 ends
Epoch 128 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 129
Epoch 129: val/epoch_NLL: 478309.16 -- val/pos_mse: 478026.25 -- val/X_kl: 2319.66 -- val/E_kl: 2736.07 -- val/charges_kl: 526.05 
Val loss: 478309.1562 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch129/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 508.96 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 74, Kekulize 1, other 2,  -- No error 947
Validity over 1024 molecules: 92.48%
Number of connected components of 1024 molecules: mean:1.08 max:3.00
Connected components of 1024 molecules: 92.58
Uniqueness: 99.05% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 67.38%
rdkit valid pharmacophore match: 68.32%
rdkit pharmacophore match 2d: 85.71%
rdkit valid pharmacophore match 2d: 86.44%
pgmg pharmacophore match: 71.70%
pgmg valid pharmacophore match: 72.23%
pgmg pharmacophore match percentage: 62.30%
pgmg valid pharmacophore match percentage: 62.41%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.033, 'sampling/AtomTypesTV': 0.182, 'sampling/EdgeTypesTV': 0.072, 'sampling/ChargeW1': 0.011, 'sampling/ValencyW1': 0.094, 'sampling/BondLengthsW1': 0.012, 'sampling/AnglesW1': 6.663}
Sampling metrics done.
Val epoch 129 ends
Train epoch 129 ends
Epoch 129 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 676.5s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 130
Train epoch 130 ends
Epoch 130 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 131
Train epoch 131 ends
Epoch 131 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 132
Train epoch 132 ends
Epoch 132 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 139.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 133
Train epoch 133 ends
Epoch 133 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 134
Train epoch 134 ends
Epoch 134 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 135
Train epoch 135 ends
Epoch 135 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.6s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 136
Train epoch 136 ends
Epoch 136 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 137
Train epoch 137 ends
Epoch 137 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 138
Train epoch 138 ends
Epoch 138 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 139
Epoch 139: val/epoch_NLL: 604127.19 -- val/pos_mse: 603855.56 -- val/X_kl: 2264.11 -- val/E_kl: 2634.26 -- val/charges_kl: 474.96 
Val loss: 604127.1875 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch139/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 510.57 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 107, Kekulize 0, other 0,  -- No error 917
Validity over 1024 molecules: 89.55%
Number of connected components of 1024 molecules: mean:1.06 max:3.00
Connected components of 1024 molecules: 94.63
Uniqueness: 98.26% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 64.65%
rdkit valid pharmacophore match: 66.41%
rdkit pharmacophore match 2d: 85.12%
rdkit valid pharmacophore match 2d: 86.03%
pgmg pharmacophore match: 72.85%
pgmg valid pharmacophore match: 73.54%
pgmg pharmacophore match percentage: 62.50%
pgmg valid pharmacophore match percentage: 63.14%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.019, 'sampling/AtomTypesTV': 0.173, 'sampling/EdgeTypesTV': 0.066, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.116, 'sampling/BondLengthsW1': 0.024, 'sampling/AnglesW1': 5.022}
Sampling metrics done.
Val epoch 139 ends
Train epoch 139 ends
Epoch 139 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 678.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 140
Train epoch 140 ends
Epoch 140 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.7s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 141
Train epoch 141 ends
Epoch 141 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 142
Train epoch 142 ends
Epoch 142 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 143
Train epoch 143 ends
Epoch 143 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 144
Train epoch 144 ends
Epoch 144 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 139.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 145
Train epoch 145 ends
Epoch 145 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 146
Train epoch 146 ends
Epoch 146 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 143.1s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 147
Train epoch 147 ends
Epoch 147 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 148
Train epoch 148 ends
Epoch 148 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 139.9s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 149
Epoch 149: val/epoch_NLL: 586552.12 -- val/pos_mse: 586272.56 -- val/X_kl: 2298.56 -- val/E_kl: 2711.28 -- val/charges_kl: 506.98 
Val loss: 586552.1250 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch149/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 505.35 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 119, Kekulize 1, other 0,  -- No error 904
Validity over 1024 molecules: 88.28%
Number of connected components of 1024 molecules: mean:1.08 max:3.00
Connected components of 1024 molecules: 92.38
Uniqueness: 99.34% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 62.40%
rdkit valid pharmacophore match: 63.27%
rdkit pharmacophore match 2d: 83.76%
rdkit valid pharmacophore match 2d: 84.80%
pgmg pharmacophore match: 69.78%
pgmg valid pharmacophore match: 70.06%
pgmg pharmacophore match percentage: 59.96%
pgmg valid pharmacophore match percentage: 59.73%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.013, 'sampling/AtomTypesTV': 0.198, 'sampling/EdgeTypesTV': 0.068, 'sampling/ChargeW1': 0.01, 'sampling/ValencyW1': 0.153, 'sampling/BondLengthsW1': 0.025, 'sampling/AnglesW1': 7.533}
Sampling metrics done.
Val epoch 149 ends
Train epoch 149 ends
Epoch 149 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 672.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 150
Train epoch 150 ends
Epoch 150 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 151
Train epoch 151 ends
Epoch 151 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 152
Train epoch 152 ends
Epoch 152 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.5s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 153
Train epoch 153 ends
Epoch 153 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 139.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 154
Train epoch 154 ends
Epoch 154 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 143.6s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 155
Train epoch 155 ends
Epoch 155 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 142.9s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 156
Train epoch 156 ends
Epoch 156 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.8s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 157
Train epoch 157 ends
Epoch 157 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 158
Train epoch 158 ends
Epoch 158 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.2s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 159
Epoch 159: val/epoch_NLL: 491617.88 -- val/pos_mse: 491339.78 -- val/X_kl: 2259.96 -- val/E_kl: 2730.09 -- val/charges_kl: 493.83 
Val loss: 491617.8750 	 Best val loss:  442020.5625

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch159/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 505.08 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 124, Kekulize 1, other 1,  -- No error 898
Validity over 1024 molecules: 87.70%
Number of connected components of 1024 molecules: mean:1.08 max:3.00
Connected components of 1024 molecules: 93.26
Uniqueness: 99.00% WARNING: do not trust this metric on multi-gpu
Novelty: 100.00%
rdkit pharmacophore match: 63.87%
rdkit valid pharmacophore match: 66.15%
rdkit pharmacophore match 2d: 84.00%
rdkit valid pharmacophore match 2d: 85.52%
pgmg pharmacophore match: 70.15%
pgmg valid pharmacophore match: 71.21%
pgmg pharmacophore match percentage: 60.74%
pgmg valid pharmacophore match percentage: 61.36%
Sparsity level on local rank 0: 74 %
Sampling metrics {'sampling/NumNodesW1': 0.012, 'sampling/AtomTypesTV': 0.18, 'sampling/EdgeTypesTV': 0.068, 'sampling/ChargeW1': 0.012, 'sampling/ValencyW1': 0.133, 'sampling/BondLengthsW1': 0.012, 'sampling/AnglesW1': 6.821}
Sampling metrics done.
Val epoch 159 ends
Train epoch 159 ends
Epoch 159 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 673.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 160
Train epoch 160 ends
Epoch 160 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.4s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 161
Train epoch 161 ends
Epoch 161 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 141.6s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 162
Train epoch 162 ends
Epoch 162 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.5s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 163
Train epoch 163 ends
Epoch 163 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.3s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 164
Train epoch 164 ends
Epoch 164 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 143.0s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 165
Train epoch 165 ends
Epoch 165 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.5s p_pos: 0.35 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 166
Train epoch 166 ends
Epoch 166 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.6s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 167
Train epoch 167 ends
Epoch 167 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.5s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 168
Train epoch 168 ends
Epoch 168 finished: pos: 0.36 -- X: 0.19 -- charges: 0.04 -- E: 0.22 -- y: -1.00 -- 140.6s p_pos: 0.36 -- p_X: 0.00 -- p_charges: 0.00 -- 
Starting epoch 169
Epoch 169: val/epoch_NLL: 320957.84 -- val/pos_mse: 320672.25 -- val/X_kl: 2377.67 -- val/E_kl: 2690.82 -- val/charges_kl: 564.93 
Val loss: 320957.8438 	 Best val loss:  320957.8438

Sampling start
Sampling a batch with 20 graphs. Saving 20 visualization and 1 full chains.
Batch sampled. Visualizing chains starts!
Visualizing chain 0/1
Molecule list generated.
Saving the gif at /home/amira/midi_two/MiDi/outputs/2024-10-26/12-39-00-noh_ada3/chains/epoch169/batch20_GR0_0.gif.
Chain saved.
Visualizing 20 individual molecules...
Visualizing done.
Sampling a batch with 1004 graphs. Saving 0 visualization and 0 full chains.
Visualizing done.
Done on 0. Sampling took 511.58 seconds

Computing sampling metrics on 0...
